<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Tug&#39;s Site Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Tug&#39;s Site Blog Atom Feed"><title data-react-helmet="true">Easy application development with Couchbase, Angular and Node | Tug&#x27;s Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://tgrall.github.io/blog/2013/03/06/easy-application-development-with-couchbase-angular-and-node"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Easy application development with Couchbase, Angular and Node | Tug&#x27;s Site"><meta data-react-helmet="true" name="description" content="Note : This article has been written in March 2013, since Couchbase and its drivers have a changed a lot. I am not working with/for Couchbase anymore, with no time to update the code."><meta data-react-helmet="true" property="og:description" content="Note : This article has been written in March 2013, since Couchbase and its drivers have a changed a lot. I am not working with/for Couchbase anymore, with no time to update the code."><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2013-03-06T00:00:00.000Z"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://tgrall.github.io/blog/2013/03/06/easy-application-development-with-couchbase-angular-and-node"><link data-react-helmet="true" rel="alternate" href="https://tgrall.github.io/blog/2013/03/06/easy-application-development-with-couchbase-angular-and-node" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://tgrall.github.io/blog/2013/03/06/easy-application-development-with-couchbase-angular-and-node" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.acbe81c6.css">
<link rel="preload" href="/assets/js/runtime~main.69db4c69.js" as="script">
<link rel="preload" href="/assets/js/main.174aeacd.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Tug&#x27;s Site</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/talks">Talks</a></div><div class="navbar__items navbar__items--right"><a href="https://windr.org" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Windsurfing App<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/tgrall/tgrall.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/05/16/simple-caching-service-with-redis">Simple caching service with Redis</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/01/02/how-to-use-ssl-slash-tls-with-redis-enterprise">How to use SSL/TLS with Redis Enterprise</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2019/09/19/redis-rolling-upgrade-on-pivotal-cloud-foundry-pcf">Redis Rolling Upgrade on Pivotal Cloud Foundry (PCF)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2019/09/04/multi-nodes-redis-cluster-with-docker">Multi-Nodes Redis Cluster with Docker</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2019/09/02/getting-with-redis-streams-and-java">Getting Started with Redis Streams and Java</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_GeHD" itemprop="headline">Easy application development with Couchbase, Angular and Node</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2013-03-06T00:00:00.000Z" itemprop="datePublished">March 6, 2013</time> Â· 14 min read</div></header><div class="markdown" itemprop="articleBody"><blockquote><p>Note : This article has been written in March 2013, since Couchbase and its drivers have a changed a lot. I am not working with/for Couchbase anymore, with no time to update the code.</p></blockquote><p>A friend of mine wants to build a simple system to capture ideas, and votes. Even if you can find many online services to do that, I think it is a good opportunity to show how easy it is to develop new application using a Couchbase and Node.js.</p><p>So how to start?</p><p>Some of us will start with the UI, other with the data, in this example I am starting with the model. The basics steps are :</p><ol><li>Model your documents</li><li>Create Views</li><li>Create Services</li><li>Create the UI</li><li>Improve your application by iteration</li></ol><p>The sources of this sample application are available in Gihub :</p><p><a href="https://github.com/tgrall/couchbase-node-ideas" target="_blank" rel="noopener noreferrer">https://github.com/tgrall/couchbase-node-ideas</a></p><p>Use the following command to clone the project locally :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">git clone https://github.com/tgrall/couchbase-node-ideas.git</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><em>Note:</em> my goal is not to provide a complete application, but to describe the key steps to develop an application.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="model-your-documents"></a>Model your documents<a class="hash-link" href="#model-your-documents" title="Direct link to heading">#</a></h3><p>For this application you need 3 types of document :</p><ul><li>Ideas : describes the idea with a author, title and description</li><li>Vote : the author and a comment - note that it is a choice to not put a value for the vote, in this first version if the vote exists this means user like the idea.</li><li>User : contains all the information about the user (not used in this first version of the application)</li></ul><p>You can argue that it is possible to put the votes as a list of element inside the idea document. In this case I prefer to use different document and reference the idea in the vote since we do not know how many votes/comments will have. Using different documents is also interesting in this case for the following reasons :</p><ul><li>No &quot;concurrent&quot; access, when a user wants to vote he does not change the idea document itself, so no need to put an optimistic locking in place.</li><li>The size of the document will be smaller and easier to cache in memory.</li></ul><p>So documents will look like:</p><iframe width="100%" frameborder="0" id="gist-79f57b13e7a637c7e62e"></iframe><p>What I really like is the fact that I can quickly create a small dataset to validate that it is correct and help me to design the view. The way I do it, I start my server, launch the Couchbase Administration Console, create a bucket, and finally insert document manually and validate the model and views.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="create-views"></a>Create Views<a class="hash-link" href="#create-views" title="Direct link to heading">#</a></h3><p>Now that I have created some documents, I can think about the way I want to get the information out of the database. For this application I need:</p><ul><li>The list of ideas</li><li>The votes by ideas</li></ul><p>The list of idea for this first version is very simple, we just need to emit the title:</p><iframe width="100%" frameborder="0" id="gist-989a5450811dec8f305e"></iframe><p>For the votes by ideas, I choose to create a collated view, this will give me some interesting options when I will expose them into an API/View layer. I am also for this view using <code>sum()</code> reduce function to be sure I capture the number of votes.</p><iframe width="100%" frameborder="0" id="gist-5fe945cbc12cc59e9dbd"></iframe><p>I have my documents, I have some views that allow me to retrieve the list of ideas, the number of vote by idea and count the vote... So I am ready to expose all these informations to the application using a simple API layer.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="create-services"></a>Create Services<a class="hash-link" href="#create-services" title="Direct link to heading">#</a></h3><p>Lately I have been playing a lot with Node.js, just because it is nice to learn new stuff and also because it is really easy to use with Couchbase. Think about it Couchbase loves JSON, and Node.js object format is JSON, this means I do not have any marshaling/unmarshaling to do.</p><p>My API layer is quite simple, I just need to create a set of REST endpoint to deal with:</p><ul><li>CRUD operation on each type of document</li><li>List the different Documents</li></ul><p>The code of the services is available in branch <a href="https://github.com/tgrall/couchbase-node-ideas/tree/01-simple-services" target="_blank" rel="noopener noreferrer">01-simple-services</a>:</p><p>You can run the application Â with simple services using the following command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&gt; git checkout -f 01-simple-services</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; node app.js</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>and go to you browser using the <a href="http://127.0.0.1:3000" target="_blank" rel="noopener noreferrer">http://127.0.0.1:3000</a></p><p><em>About the project</em></p><p>For this project I am using only 2 node modules <a href="http://expressjs.com/" target="_blank" rel="noopener noreferrer">Express</a> and <a href="https://github.com/couchbase/couchnode" target="_blank" rel="noopener noreferrer">Couchbase</a>. The package.json file looks like :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;name&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;couchbase-ideas-management&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;version&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0.0.1&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;private&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">true</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;dependencies&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;express&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;3.x&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;couchbase&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;0.0.11&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>After running the install, let&#x27;s code the new API interface, as said before I am using an iterative approach so for now I am not dealing with the security, I just want to get the basic actions to work.</p><p>I am starting with the endpoints to get and set the documents. I am creating a generic endpoints that take the type as URI parameter allowing user/application to do a get/post on <code>/api/vote</code>, <code>/api/idea</code>. The following code captures this:</p><iframe width="100%" frameborder="0" id="gist-42f0b936a55fd2dcefac"></iframe><p>In each case I start to test if the URI is one of the supported types (idea, vote, user) and if this is the case I call the <code>get()</code> or <code>upsert()</code> method that will do the call to Couchbase.</p><p>The <code>get()</code> and <code>upsert()</code> methods are using more or less the same approach. I test if the document exists, if the type is correct and do the operation to Couchbase. Let&#x27;s focus on the <code>upsert()`` method. I call it </code>upsert()` since the same operation is used to create and update the document.</p><iframe width="100%" frameborder="0" id="gist-91858dcad51affdf3521"></iframe><p>In this function I start by testing if the document contains a type and if the type is the one expected (line 3).</p><p>Then I check if the document id is present, to see if I need to create it or not. This is one of the reason why I like to keep the id/key in the document, yes I duplicate it, but it makes the development really easy. So if I have to create a new document I have to generate a new id. I chose to create a counter for each type. this is why I call the incr function (line 7) and then use the returned value to create the document (line 10).</p><p><em>Note:</em> as you can see, my documents contain the an ID as part of the attributes. This ID is the same value that the one used to set the document (the &quot;key&quot;). It is not necessary a good practice to duplicate this information, and in many case the application only use the document key itself. I personally like to put the ID in the document itself too, because it simplifies a lot the development.</p><p>If the ID is present, I just call the update operation to save the document. (line 15)</p><p>The delete operation is equivalent to the get, using the delete HTTP operation.</p><p>So now I can get, insert and update the documents. I still need to do some work to deal with the lists. As you can guess, here I need to call the views. I won&#x27;t go in the detail of the simple list of ideas. Let&#x27;s focus on the view that shows the result of the votes.</p><iframe width="100%" frameborder="0" id="gist-6468058737ff53553ae1"></iframe><p>For this part of the application I use a small trick to use the collated view. The <code>/api/results/</code> call returns the list of ideas with their title and the total number of votes. The result looks like the following:</p><iframe width="100%" frameborder="0" id="gist-6cfdedf1410ca99744bd"></iframe><p>Note that it is also possible to select only one idea , you just need to pass the id to the call for example.</p><p>If you look in more detail the function, not only I call the view, but I build an array in which I put the idea id, label, then on the next loop, I add the number of vote. This is possible because the view is a collated view of the ideas and its votes.</p><p>I have now my REST Services, including advanced query capabilities. It is time now to use these services and build the user interface.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="create-the-ui"></a>Create the UI<a class="hash-link" href="#create-the-ui" title="Direct link to heading">#</a></h3><p>For the view I am using AngularJS, that I am packaging in the same node.js application for simplicity reason</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="simple-ui-without-loginsecurity"></a>Simple UI without Login/Security<a class="hash-link" href="#simple-ui-without-loginsecurity" title="Direct link to heading">#</a></h4><p>The code of the application without login is available branch in <a href="https://github.com/tgrall/couchbase-node-ideas/tree/02-simple-ui-no-login" target="_blank" rel="noopener noreferrer">02-simple-ui-no-login</a></p><p>You can run the application Â with simple services using the following command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> checkout -f 02-simple-ui-no-login</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> node app.js</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The application is based on AngularJS and Twitter Boostrap.</p><p>I am using basic feature and packaging for Angular :</p><ul><li><code>/public/js/app.js</code> contains the module declaration and all the routes to the different views/controllers</li><li><code>/public/js/controllers.js</code> contains all the controller. I will show some of them but basically this is where that I call the services that I have created above.</li><li><code>/views/partials/</code> contains the different pages/screens used by the application.</li></ul><p>Because the application is quite simple I have not done any packaging of directive, or other functions. This is true at for AngularJS and Node.js parts.</p><p><em>Dummy user management</em></p><p>In this first version of the UI I have not yet integrated any login/security, so I fake the user login using a global scope variable that <code>$scope.user</code> that you can see in the controller <code>AppCtrl()</code>. Since I have not yet implemented the login/security, I have added at the bottom of the page a textfield where you can enter a &quot;dummy&quot; username to test the application. This field is inserted in the <code>/views/index.html</code> page.</p><p><em>List Views and Number of Votes</em></p><p>The home page of the application contains the list of ideas and number of votes.</p><p><img src="http://2.bp.blogspot.com/-tniNkr_Pl0Q/USidTLKHw1I/AAAAAAAAAbQ/BWtfTaAWG1w/s320/ideas-home-page.png"></p><p>Look at the EntriesListCtrl controller and the <code>view/index.html</code> file. As you can guess this is based on the Couchbase collated view that return the list of ideas and number of vote.</p><p><em>Create/Edit an idea</em></p><p>When the user click on the New link in the navigation, the application call the view <code>/view/partials/idea-form.html</code>. Â This form is called using the &quot;/#/idea/new&quot; URL.</p><p>Just look at the <code>IdeaFormCtrl</code> controller to see what is happening :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly javascript"><pre tabindex="0" class="prism-code language-javascript codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function maybe-class-name" style="color:#d73a49">IdeaFormCtrl</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">$rootScope</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> $scope</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> $routeParams</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> $http</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> $location</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  $scope</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">idea</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword null nil" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword control-flow" style="color:#00009f">if</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">$routeParams</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token function" style="color:#d73a49">$http</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">method</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;GET&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> url</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;/api/idea/&#x27;</span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> $routeParams</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">id</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">success</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> status</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> headers</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">           </span></span><span class="token-line" style="color:#393A34"><span class="token plain">                $scope</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">idea</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    $scope</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">save</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">          </span></span><span class="token-line" style="color:#393A34"><span class="token plain">        $scope</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">idea</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">type</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;idea&quot;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// set the type</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        $scope</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">idea</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">user_id</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> $scope</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">user</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        $http</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">post</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/api/idea&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">$scope</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">idea</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">success</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">data</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            $</span><span class="token dom variable" style="color:#36acaa">location</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    $scope</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">cancel</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        $</span><span class="token dom variable" style="color:#36acaa">location</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method function property-access" style="color:#d73a49">path</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;/&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token maybe-class-name">IdeaFormCtrl</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">$inject</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token string" style="color:#e3116c">&#x27;$rootScope&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;$scope&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;$routeParams&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token string" style="color:#e3116c">&#x27;$http&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;$location&#x27;</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>First of all I test if the controller is called with a idea identifier in the URL ( <code>$routeParams.id</code> - line 3) . If the ID is present, I call the REST API to get the idea and set it into the <code>$scope.idea</code> variable.</p><p>Then on line 9, you can see the <code>$scope.save()</code> function that calls the REST API to save/update the idea to Couchbase. I use the line 10 and 11 to set the user and the type of data to the idea.</p><p><em>Note:</em> It is interesting to look at these lines, by adding the two attributes (user &amp; type) I modify the &quot;schema&quot; of my data. I am adding new fields to my document that will be stored as it is in Couchbase. Once again, you see here that I drive the data type from my application. I could take another approach and force the type in the service layer. For this example I chose to put that in the application layer, that is supposed to send the proper data types.</p><p><em>Other Interactions</em></p><p>The same approach is used to create a vote associated to a user/idea as you can see in the <code>VoteFormCtrl</code>  controller.</p><p>I won&#x27;t go in all the details of all operations, I am just inviting you to look at the code of the application, and feel free to add comment to this blog post if I need to clarify other part of the application.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="iterative-development--adding-a-value-to-the-vote"></a>Iterative Development : adding a value to the vote!<a class="hash-link" href="#iterative-development--adding-a-value-to-the-vote" title="Direct link to heading">#</a></h4><p>The code of the services is available in branch 01-simple-services:</p><p>You can run the application with simple services using the following command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">&gt; git checkout -f 03-vote-with-value</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&gt; node app.js</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><em>Adding the field in the form</em></p><p>Something that I really like about working with AngularJS, Node and Couchbase is the fact that the developer uses JSON from the database to the browser.</p><p>So let&#x27;s implement a new feature, where instead of having only a comment the user can give a rate to its vote from 1 to 5. Doing that is quite easy, here are the steps:</p><ul><li>Modify the UI : adding a new field</li><li>Modify the Couchabe View to use the new field</li></ul><p>This is it! AngularJS deals with the binding of the new field, so I just need to edit the <code>/views/partials/idea-form.html</code> to add this. For this I need to add the list of values in the controller and expose it into a select box in form.</p><p>The list of value located in the <code>$scope.ratings</code> variable :</p><iframe width="100%" frameborder="0" id="gist-fe7c8625a6f54dfd2425"></iframe><p>Once this is done you can add a select box into your view using the following code :</p><iframe width="100%" frameborder="0" id="gist-d4115c3dbdd5a25614d9"></iframe><p>To add the select box into the form, I just use AngularJS features:</p><ul><li>the list of value described in my controller using the <code>ng-options</code> attribute</li><li>the binding to the vote.rating field object using <code>ng-model</code> attribute.</li></ul><p>I am adding the field in my form, I bind this field to my Javascript object; and... nothing else! Since my REST API is just consuming the JSON object as it is, AngularJS will send the vote object with the new attribute.</p><p><em>Update the view to use the rating</em></p><p>Now that my database is dealing with a new attribute in the vote, I need to update my view to use this in the sum function. (I could calculate an average too, but here I want the sum of all the vote/ratings).</p><iframe width="100%" frameborder="0" id="gist-c2fb3f9a3127df75e454"></iframe><p>The only line that I have changed is the line number 7. The logic is simple, if the rating is present I emit it, if not I emit a 2, that is a medium rating for an idea.</p><p>This is a small tip that allow me to have a working view/system without having to update all the existing document if I have some.</p><p>I&#x27;ll stop here for now, and will add new feature later such as User Authentication and User Management using for example <a href="http://passportjs.org/" target="_blank" rel="noopener noreferrer">Passport</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="version-and-upgrade-management"></a>Version and Upgrade Management<a class="hash-link" href="#version-and-upgrade-management" title="Direct link to heading">#</a></h3><p>If you looked closely to the code of the application the views are automatically imported from the app.js file when the application is starting.</p><p>In fact I have added a small function that check the current version installed and update the views with the correct version when needed.</p><p>You can look at the function <a href="https://github.com/tgrall/couchbase-node-ideas/blob/03-vote-with-value/app.js#L21" target="_blank" rel="noopener noreferrer"><code>initApplication()</code></a> :</p><ul><li>Load the version number from Couchbase (document with ID &quot;<code>app.version</code>&quot;)</li><li>Check the version of if this is different</li><li>Update/Create the view (I am doing it in production mode here, in real application it will be better to use dev mode - just prefix the design document ID with <code>&quot;dev_&quot;</code> )</li><li>Once the view is created update/create the <code>&quot;app.version&quot;</code> document with the new ID.</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="conclusion"></a>Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">#</a></h3><p>In this article we have seen how you can quickly develop your application/prototype and leverage the flexibility of NoSQL for developers. The steps to do this are:</p><ol><li>Design your document model and API (REST)</li><li>Create the UI that consumes the API</li><li>Modify your model by simply adding field into the UI</li><li>Update the view to adapt your lists to your new model</li></ol><p>In addition to this, I have also quickly explain how you can from your code control the version of your application and deploy new views (and other things) automatically.</p><p>I will post another blog post in few days to explain how you can easily integrate user management, security to your application and database easily</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2013/04/29/screencast-fun-with-couchbase-mapreduce-and-twitter"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« Screencast : Fun with Couchbase MapReduce and Twitter</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2013/02/18/how-to-get-the-latest-document-by-date-slash-time-field"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">How to get the latest document by date/time field? Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#model-your-documents" class="table-of-contents__link">Model your documents</a></li><li><a href="#create-views" class="table-of-contents__link">Create Views</a></li><li><a href="#create-services" class="table-of-contents__link">Create Services</a></li><li><a href="#create-the-ui" class="table-of-contents__link">Create the UI</a></li><li><a href="#version-and-upgrade-management" class="table-of-contents__link">Version and Upgrade Management</a></li><li><a href="#conclusion" class="table-of-contents__link">Conclusion</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/tgrall" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/tugdualgrall/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/tgrall" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2003 - 2021 Tugdual Grall built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.69db4c69.js"></script>
<script src="/assets/js/main.174aeacd.js"></script>
</body>
</html>