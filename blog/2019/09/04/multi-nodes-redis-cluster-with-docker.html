<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.4.3">
<title data-rh="true">Multi-Nodes Redis Cluster with Docker | Tug&#x27;s Site</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://tgrall.github.io/blog/2019/09/04/multi-nodes-redis-cluster-with-docker"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" name="keywords" content="github, development, blog, devops, devsecops, cloud, java, javascript, copilot"><meta data-rh="true" property="og:title" content="Multi-Nodes Redis Cluster with Docker | Tug&#x27;s Site"><meta data-rh="true" name="description" content="As part of my on-boarding/training at RedisLabs I continue to play with the product, and I have decided today to install a local 3 nodes cluster of Redis Enterprise Software (RS); and show how easy is to move from a single node/shard database to a multi nodes highly available one."><meta data-rh="true" property="og:description" content="As part of my on-boarding/training at RedisLabs I continue to play with the product, and I have decided today to install a local 3 nodes cluster of Redis Enterprise Software (RS); and show how easy is to move from a single node/shard database to a multi nodes highly available one."><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2019-09-04T00:00:00.000Z"><meta data-rh="true" property="article:tag" content="redis,nosql,cluster,docker,container,cloud"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://tgrall.github.io/blog/2019/09/04/multi-nodes-redis-cluster-with-docker"><link data-rh="true" rel="alternate" href="https://tgrall.github.io/blog/2019/09/04/multi-nodes-redis-cluster-with-docker" hreflang="en"><link data-rh="true" rel="alternate" href="https://tgrall.github.io/blog/2019/09/04/multi-nodes-redis-cluster-with-docker" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Tug&#39;s Site RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Tug&#39;s Site Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-1520374-2","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><link rel="stylesheet" href="/assets/css/styles.5f5c74fb.css">
<link rel="preload" href="/assets/js/runtime~main.41ccae61.js" as="script">
<link rel="preload" href="/assets/js/main.cdc31fd6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}return t}()||function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Tug&#x27;s Site</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/talks">Talks</a></div><div class="navbar__items navbar__items--right"><a href="https://windr.org" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Windsurfing App<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/tgrall/tgrall.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/12/16/quarkus-database-projection-with-panache">Quarkus: Database Projection with Panache</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/12/13/github-copilot-assist-generate-test-data">Simplifying Data Generation with GitHub Copilot</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/12/09/quarkus-entity-default-value">Quarkus: Default Values for Panache Entity Fields</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/03/31/revoke-github-deploy-key-org-level">Revoke Deploy Keys with GitHub CLI</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog/2023/02/21/copilot-how-i-use-it-why-i-love-it">GitHub Copilot: How I use it, and Why I love it</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><meta itemprop="description" content="As part of my on-boarding/training at RedisLabs I continue to play with the product, and I have decided today to install a local 3 nodes cluster of Redis Enterprise Software (RS); and show how easy is to move from a single node/shard database to a multi nodes highly available one."><header><h1 class="title_f1Hy" itemprop="headline">Multi-Nodes Redis Cluster with Docker</h1><div class="container_mt6G margin-vert--md"><time datetime="2019-09-04T00:00:00.000Z" itemprop="datePublished">September 4, 2019</time> · <!-- -->8 min read</div></header><div id="__blog-post-container" class="markdown" itemprop="articleBody"><p>As part of my on-boarding/training at RedisLabs I continue to play with the product, and I have decided today to install a local 3 nodes cluster of Redis Enterprise Software (RS); and show how easy is to move from a single node/shard database to a multi nodes highly available one.</p><p>Once your cluster is up &amp; running, you will kill some containers to see how the system automatically fail-over to guarantee service continuity.</p><p>The deployment will look more or less like the schema below, (<em><a href="https://docs.redislabs.com/latest/rs/getting-started/docker/" target="_blank" rel="noopener noreferrer">coming from RedisLabs documentation</a></em>)</p><p><img loading="lazy" src="/assets/images/docker-deployment-05a51fa9caeb5a4cfa634e53d3563ebb.png" width="777" height="380" class="img_ev3q"></p><p>This is a perfect environment for learning, developing and testing your applications, but it is not supported in production; for production, you can use:</p><ul><li><a href="https://redislabs.com/redis-enterprise/pro/" target="_blank" rel="noopener noreferrer">Redis Cloud</a></li><li><a href="https://docs.redislabs.com/latest/platforms/openshift/" target="_blank" rel="noopener noreferrer">Redis Enterprise Software with Kubernetes and Red Hat OpenShift</a></li><li><a href="https://docs.redislabs.com/latest/platforms/pks/" target="_blank" rel="noopener noreferrer">Redis Enterprise Software with Kubernetes Operator on PKS (Pivotal Container Service)</a></li><li><a href="https://docs.redislabs.com/latest/platforms/pcf/" target="_blank" rel="noopener noreferrer">Redis Enterprise for Pivotal Cloud Foundry (PCF)</a>.</li></ul><p><strong>Prerequisites:</strong></p><ul><li>Docker Desktop (<em>I am running Docker on Mac</em>)</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="installing-and-running-your-first-redis-node">Installing and Running your First Redis Node<a href="#installing-and-running-your-first-redis-node" class="hash-link" aria-label="Direct link to Installing and Running your First Redis Node" title="Direct link to Installing and Running your First Redis Node">​</a></h3><p>As usual, installing a new product with Docker is very simple just run the following command:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d --cap-add sys_resource </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--name  redis-node1 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-p </span><span class="token number" style="color:#36acaa">8443</span><span class="token plain">:8443 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-p </span><span class="token number" style="color:#36acaa">9443</span><span class="token plain">:9443 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-p </span><span class="token number" style="color:#36acaa">12000</span><span class="token plain">:12000 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redislabs/redis</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Let&#x27;s look at the parameters used here:</p><ul><li><code>-d</code>: run the container in the background</li><li><code>--cap-add sys_resource</code>: add Linux  <code>sys_resource</code>capabilities to set proper privileges</li><li><code>--name  redis-node1</code>: naming the container</li><li><code>-p 8443:8443</code>: to access the management web UI (HTTPS)</li><li><code>-p 9443:9443</code>: to access the REST API (HTTPS)</li><li><code>-p 12000:12000</code>: the TCP port that we will use for the database endpoint on this node</li><li><code>redislabs/redis</code>: use the RedisLabs image (the enterprise version of Redis)</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-new-cluster">Creating a new Cluster<a href="#creating-a-new-cluster" class="hash-link" aria-label="Direct link to Creating a new Cluster" title="Direct link to Creating a new Cluster">​</a></h4><p>Once the container is started you can configure the &quot;cluster&quot;.</p><ol><li>Go top https://localhost:8443/ (accept the connect using the temporary certificate)</li><li>Click &quot;Setup&quot;</li><li>Change the Cluster Name to &quot;my-redis-cluster.tug-demo.com&quot;</li><li>Click &quot;Next&quot;</li><li>On the &quot;cluster authentication&quot; click &quot;Next&quot;  <em>(we will be using the free version)</em></li><li>Enter the user admin credentials and click &quot;Next&quot;.</li></ol><p>Once it is configured, connect to the console to the console using the credentials you have created.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="adding-a-new-database">Adding a new database<a href="#adding-a-new-database" class="hash-link" aria-label="Direct link to Adding a new database" title="Direct link to Adding a new database">​</a></h4><p>Now you have to create a new database.</p><ol><li>Select &quot;Redis Database&quot; and &quot;Single Region&quot;</li><li>Enter the name &quot;test-db-001&quot;, and &quot;0.5&quot; for the memory limit</li><li>Click &quot;Show Advanced Options&quot;</li><li>Enter 12000 in the &quot;Endpoint port number&quot; field</li><li>Click &quot;Activate&quot;.</li></ol><p>After  fewseconds, the database is created and available.</p><p>Note: we have not set anything special around clustering and replication; we will do that later.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="using-the-single-node-database">Using the Single Node Database<a href="#using-the-single-node-database" class="hash-link" aria-label="Direct link to Using the Single Node Database" title="Direct link to Using the Single Node Database">​</a></h4><p>You can now connect to the database. You can use  <code>redis-cli</code>from your host, or you can connect to the container and do it from there:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain">  exec-it redis-node1 /bin/bash</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redislabs@0a174e819a6b:/opt$ redis-cli -p </span><span class="token number" style="color:#36acaa">12000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:1200</span><span class="token operator file-descriptor important" style="color:#393A34">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> SET foo bar</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OK</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:1200</span><span class="token operator file-descriptor important" style="color:#393A34">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> GET foo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token string" style="color:#e3116c">&quot;bar&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1:1200</span><span class="token operator file-descriptor important" style="color:#393A34">0</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain">  </span><span class="token builtin class-name">exit</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong><em>Checkpoint</em></strong></p><p>So far you have:</p><ol><li>Install a single node cluster of Redis Enterprise using Docker</li><li>Create a new cluster</li><li>Created a database that listens on port 12000.</li></ol><p>In the container, run the  <code>rladminstatus</code>command, to get information about your deployment.</p><p><img loading="lazy" src="/assets/images/rladmin-status-16379dccf81bf3c9aa0f0167d2b17a66.png" width="875" height="274" class="img_ev3q"></p><p>In the cluster node section, you can see the address of the node, 172.17.0.2 in my case. This is the IP address of the container, that will be used to create the multi-node cluster.</p><p>It is time to add new nodes to the cluster and enable replication and sharding</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="adding-new-nodes">Adding new nodes<a href="#adding-new-nodes" class="hash-link" aria-label="Direct link to Adding new nodes" title="Direct link to Adding new nodes">​</a></h3><p>To add new nodes to the cluster, you start new containers. Since the 3 containers will be running on the same host, it is necessary, to avoid conflicts, to use different mapping to the Web UI, REST API, and database endpoint ports.</p><p><strong>Start node 2:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d --cap-add sys_resource </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--name redis-node2 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-p </span><span class="token number" style="color:#36acaa">8444</span><span class="token plain">:8443 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-p </span><span class="token number" style="color:#36acaa">9444</span><span class="token plain">:9443 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-p </span><span class="token number" style="color:#36acaa">12001</span><span class="token plain">:12000 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redislabs/redis</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><strong>Start node 3:</strong></p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> run -d --cap-add sys_resource </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--name redis-node3 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-p </span><span class="token number" style="color:#36acaa">8445</span><span class="token plain">:8443 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-p </span><span class="token number" style="color:#36acaa">9445</span><span class="token plain">:9443 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">-p </span><span class="token number" style="color:#36acaa">12002</span><span class="token plain">:12000 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">redislabs/redis</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>So to configure each node you need to use the URLs:</p><ul><li>node 2: https://localhost:8444/</li><li>node 3: https://localhost:8445/</li></ul><p>I have just increase the port number of the Web UI (8443: node 1, 8444: node 2, 8445 node 3).</p><p>For these 2 new nodes, do the following steps to add them to the cluster:</p><ol><li>Click &quot;Setup&quot;</li><li>In  clusterconfiguration, select &quot;Join Cluster&quot;,<ul><li>Enter the IP address of the first node, 172.17.0.2 in my environment</li><li>Enter the credentials you have used during the installation of the first node.</li></ul></li><li>Click &quot;Next&quot;</li></ol><p>After a few seconds, you will be redirected to the home page and see the list of nodes of your cluster.</p><p>Repeat the same steps for the third node.</p><p>Your environment should look like this after the installation and configuration of the 3 nodes.</p><p><img loading="lazy" src="/assets/images/cluster-view-3-nodes-6befd66b9328c4d6f767fd4adc0f326f.png" width="1039" height="457" class="img_ev3q"></p><p>You can also reuse the  <code>rladminstatus</code>command on one of the containers and see the new configuration.</p><p>If you look carefully, you can see that you have only 1 shard in your cluster. Let&#x27;s now add a new shard to the database.</p><p><strong>Enabling Clustering and Replication to the DB</strong></p><p>In the Redis Enterprise Admin Web UI, (<em>you can use any of the nodes</em>):</p><ol><li>Click on the &quot;databases&quot; tab</li><li>Click on &quot;test-db-001&quot; database</li><li>Click on the &quot;configuration&quot;</li><li>Go to the bottom of the page and click &quot;Edit&quot;</li><li>Check the &quot;Replication&quot; checkbox, to create new shard that will be a replica, to provide high availability</li><li>Check &quot;Database Clustering&quot; and increase the number of shards to 2. This will  <em>distribute</em>the data in your database into 2 shards, this for better scalability.
<em>You can see that the UI indicated that you have  </em>4 shards with replication*. Yes because you have a database that you have &quot;divided in 2&quot;, and each of the portions of the database is replicated.
(Also with the free version of Redis Enterprise you are limited to 4 shards, so do not be surprised if you can not increase the number of shards to more than 4)</li><li>Click &quot;Update&quot; at the bottom of the page.</li></ol><p>Go back to the &quot;nodes&quot; tab, and you will see that you have now 4 shards distributed on your 3 nodes.</p><p><strong>Discovering the cluster topology</strong></p><p>Run  <code>rladminstatus</code>to inspect your cluster and see how the various components are installed:</p><p><img loading="lazy" src="/assets/images/rladmin-status-with-db-33f34506e1169431e210c48062116db0.png" width="1206" height="404" class="img_ev3q"></p><p>For example, you can see, that in my environment:</p><p><em>in the &quot;CLUSTER NODES&quot; section that the &quot;node:1&quot; is the master of the cluster
</em>in the &quot;DATABASES&quot; section that replication is enabled, and the database uses a &quot;<a href="https://docs.redislabs.com/latest/rs/concepts/rebalancing-shard-placement/#dense-shard-placement-policy" target="_blank" rel="noopener noreferrer">dense placement</a>&quot;
<em>in the &quot;SHARDS&quot; section you can see the various shards and their placement (</em>node:1|2|3<em>), their role (</em>master|slave*) and their slots.</p><p>Using Redis Enterprise Enterprise Software (RS), all the clustering is managed transparently for you, and your applications. This means that you just have to connect your application to RS Cluster.</p><p><strong>Clustering in Action</strong></p><p>First of all, you have already seen a lot, just using the Web UI (and you could have done it using CLI and REST API), you have moved an existing database from a single instance to a distributed and highly available instance.</p><p>So now if something happens to the system, for example, if one of the masters disappears RS will automatically get another  oneelected.</p><p>Let me kill for example the node 3 that contains the 2 masters for my database.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain">  killredis-node3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After a few seconds, you should see that the master shards are now on another node, in my case node:1.</p><p><img loading="lazy" src="/assets/images/rladmin-status-with-db-002-a1597c1c3fa0c1f1931c9708b14ece85.png" width="1208" height="519" class="img_ev3q"></p><p>So if an application, is using this cluster it would be almost transparent as the election of the new master is happening in the  backgroud.</p><p>If you restart the node 3 it will rejoin the cluster, and the replicas will be updated on node 3 with any changes that happened to the masters.</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> start  redis-node3</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The same automatic fail-over will happen if you kill a node with the cluster  manager,or the endpoint.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="conclusion">Conclusion<a href="#conclusion" class="hash-link" aria-label="Direct link to Conclusion" title="Direct link to Conclusion">​</a></h4><p>In this small article you have learned how to:</p><ul><li>deploy a 3 nodes Redis Enterprise Server (RS) on Docker (on a single host)</li><li>create a database, and make it highly available and distributed easily using the Admin UI</li><li>look at the deployment using  <code>rladminstatus</code>command.</li></ul><p>You have also seen, by killing some nodes, how the cluster fail-over will various master services (shards, endpoint, master cluster node) to another node automatically. This to ensure a continuity of service for your application.</p><p>In another  postI will show what is the exact behavior of client applications during the fail-over.</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/redis">redis</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/nosql">nosql</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/cluster">cluster</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/docker">docker</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/container">container</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/cloud">cloud</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.dev/tgrall/tgrall.github.io/blob/main/blog/2019-09-04-multi-nodes-redis-cluster-with-docker.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/2019/09/19/redis-rolling-upgrade-on-pivotal-cloud-foundry-pcf"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Redis Rolling Upgrade on Pivotal Cloud Foundry (PCF)</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2019/09/02/getting-with-redis-streams-and-java"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Getting Started with Redis Streams and Java</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#installing-and-running-your-first-redis-node" class="table-of-contents__link toc-highlight">Installing and Running your First Redis Node</a></li><li><a href="#adding-new-nodes" class="table-of-contents__link toc-highlight">Adding new nodes</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://twitter.com/tgrall" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCA1kgHJTFZW-MRcr8KX_QYQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/tugdualgrall/" target="_blank" rel="noopener noreferrer" class="footer__link-item">LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/tgrall" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2003 -- 2023 Tugdual Grall built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.41ccae61.js"></script>
<script src="/assets/js/main.cdc31fd6.js"></script>
</body>
</html>