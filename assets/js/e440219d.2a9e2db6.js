"use strict";(self.webpackChunktgrall_blog=self.webpackChunktgrall_blog||[]).push([[57421],{3905:function(e,t,a){a.d(t,{Zo:function(){return c},kt:function(){return u}});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function p(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var l=n.createContext({}),s=function(e){var t=n.useContext(l),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},c=function(e){var t=s(e.components);return n.createElement(l.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,l=e.parentName,c=p(e,["components","mdxType","originalType","parentName"]),d=s(a),u=r,k=d["".concat(l,".").concat(u)]||d[u]||m[u]||i;return a?n.createElement(k,o(o({ref:t},c),{},{components:a})):n.createElement(k,o({ref:t},c))}));function u(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=d;var p={};for(var l in t)hasOwnProperty.call(t,l)&&(p[l]=t[l]);p.originalType=e,p.mdxType="string"==typeof e?e:r,o[1]=p;for(var s=2;s<i;s++)o[s]=a[s];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},59704:function(e,t,a){a.r(t),a.d(t,{frontMatter:function(){return p},contentTitle:function(){return l},metadata:function(){return s},assets:function(){return c},toc:function(){return m},default:function(){return u}});var n=a(87462),r=a(63366),i=(a(67294),a(3905)),o=["components"],p={title:"Getting started with Apache Flink and Mapr Streams",categories:"streaming flink mapr"},l=void 0,s={permalink:"/blog/2016/10/17/getting-started-with-apache-flink-and-mapr-streams",editUrl:"https://github.dev/tgrall/tgrall.github.io/blob/main/blog/2016-10-17-getting-started-with-apache-flink-and-mapr-streams.md",source:"@site/blog/2016-10-17-getting-started-with-apache-flink-and-mapr-streams.md",title:"Getting started with Apache Flink and Mapr Streams",description:"Introduction",date:"2016-10-17T00:00:00.000Z",formattedDate:"October 17, 2016",tags:[],readingTime:6.67,truncated:!0,authors:[],prevItem:{title:"Getting Started with MQTT and Java",permalink:"/blog/2017/01/02/getting-started-with-mqtt"},nextItem:{title:"Getting started with Apache Flink and Kafka",permalink:"/blog/2016/10/12/getting-started-with-apache-flink-and-kafka"}},c={authorsImageUrls:[]},m=[{value:"Introduction",id:"introduction",children:[{value:"Prerequisites",id:"prerequisites",children:[]}]},{value:"Create your Flink Streaming Project",id:"create-your-flink-streaming-project",children:[]},{value:"Add Kafka &amp; MapR Streams Dependencies",id:"add-kafka--mapr-streams-dependencies",children:[]},{value:"Create the MapR Streams and Topic",id:"create-the-mapr-streams-and-topic",children:[{value:"Install and use MapR Kafka utilities",id:"install-and-use-mapr-kafka-utilities",children:[]}]},{value:"Write your Flink application",id:"write-your-flink-application",children:[{value:"Producer",id:"producer",children:[]},{value:"Consumer",id:"consumer",children:[]}]},{value:"Build and Run the application",id:"build-and-run-the-application",children:[]},{value:"Conclusion",id:"conclusion",children:[]}],d={toc:m};function u(e){var t=e.components,a=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,n.Z)({},d,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://flink.apache.org/"},"Apache Flink")," is an open source platform for distributed stream and batch data processing. Flink is a streaming data flow engine with several APIs to create data streams oriented application."),(0,i.kt)("p",null,"It is very common for Flink applications to use ",(0,i.kt)("a",{parentName:"p",href:"http://kafka.apache.org/"},"Apache Kafka")," for data input and output."),(0,i.kt)("p",null,"This article will guide you into  the steps to use Apache Flink with ",(0,i.kt)("a",{parentName:"p",href:"https://www.mapr.com/products/mapr-streams"},"MapR Streams"),". MapR Streams is a distributed messaging system for streaming event data at scale, and it\u2019s integrated into the ",(0,i.kt)("a",{parentName:"p",href:"https://www.mapr.com/products/mapr-converged-data-platform"},"MapR Converged Data Platform"),", based on the Apache Kafka API (0.9.0),\nthis article use the same code and approach than the ",(0,i.kt)("a",{parentName:"p",href:"http://tgrall.github.io/blog/2016/10/12/getting-started-with-apache-flink-and-kafka/"},"Flink and Kafka Getting Started"),"."),(0,i.kt)("p",null,(0,i.kt)("img",{parentName:"p",src:"http://tgrall.github.io/images/posts/flink-kafka/flink-mapr-streams.png",alt:"MapR Streams and Flink"}),"."),(0,i.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"MapR 5.2",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"You can use ",(0,i.kt)("a",{parentName:"li",href:"https://www.mapr.com/products/mapr-sandbox-hadoop"},"MapR Converged Data Platform Sandbox")))),(0,i.kt)("li",{parentName:"ul"},"MapR Client installed on your development host",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"http://maprdocs.mapr.com/home/AdvancedInstallation/SettingUptheClient-install-mapr-client.html"},"Installation and Configuration steps")))),(0,i.kt)("li",{parentName:"ul"},"Git"),(0,i.kt)("li",{parentName:"ul"},"Maven 3.x or later")),(0,i.kt)("h2",{id:"create-your-flink-streaming-project"},"Create your Flink Streaming Project"),(0,i.kt)("p",null,"The first step is to create an Java application, the easiest is to use the flink-quickstart-java archetype, that contains the core dependencies and packaging tasks. This article is similar with the ",(0,i.kt)("a",{parentName:"p",href:"https://ci.apache.org/projects/flink/flink-docs-release-1.1/quickstart/run_example_quickstart.html"},"Apache Flink Quick Start Example"),", with a clear focus on data input and output with MapR Streams. "),(0,i.kt)("p",null,"In this application we will create two jobs:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"WriteToKafka")," : that generates random string and post them to a MapR Streams Topic using the Kafka Flink Connector and its Producer API."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"ReadFromKafka")," : that reads the same topic and print the messages in the standard output using the Kafka Flink Connector and its Consumer. API.")),(0,i.kt)("p",null,"The full project is available on GitHub:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/mapr-demos/mapr-streams-flink-demo"},"MapR Streams Flink Demo"))),(0,i.kt)("p",null,"Let\u2019s create the project using Apache Maven:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"mvn archetype:generate \\\n      -DarchetypeGroupId=org.apache.flink\\\n      -DarchetypeArtifactId=flink-quickstart-java \\\n      -DarchetypeVersion=1.1.2 \\\n      -DgroupId=com.mapr.demos \\\n      -DartifactId=mapr-streams-flink-demo \\\n      -Dversion=1.0-SNAPSHOT \\\n      -DinteractiveMode=false \n\n")),(0,i.kt)("p",null,"Maven will create the following structure:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ tree mapr-streams-flink-demo/\nmapr-streams-flink-demo/\n\u251c\u2500\u2500 pom.xml\n\u2514\u2500\u2500 src\n    \u2514\u2500\u2500 main\n        \u251c\u2500\u2500 java\n        \u2502   \u2514\u2500\u2500 com\n        \u2502       \u2514\u2500\u2500 mapr\n        \u2502           \u2514\u2500\u2500 demos\n        \u2502               \u251c\u2500\u2500 BatchJob.java\n        \u2502               \u251c\u2500\u2500 SocketTextStreamWordCount.java\n        \u2502               \u251c\u2500\u2500 StreamingJob.java\n        \u2502               \u2514\u2500\u2500 WordCount.java\n        \u2514\u2500\u2500 resources\n            \u2514\u2500\u2500 log4j.properties\n")),(0,i.kt)("p",null,"This project is configured to create a Jar file that contains your flink project code and also includes all dependencies needed to run it."),(0,i.kt)("p",null,"The project contains some other sample jobs, we do not need them for this article, you can either keep them to educational purposes or simply remove them from the project."),(0,i.kt)("h2",{id:"add-kafka--mapr-streams-dependencies"},"Add Kafka & MapR Streams Dependencies"),(0,i.kt)("p",null,"Open the ",(0,i.kt)("inlineCode",{parentName:"p"},"pom.xml")," and add the following dependencies to your project:"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"1- Add MapR Maven Repository")),(0,i.kt)("p",null,"In the ",(0,i.kt)("inlineCode",{parentName:"p"},"<repositories>")," element add :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"   <repository>\n     <id>mapr-releases</id>\n     <url>http://repository.mapr.com/maven/</url>\n     <snapshots><enabled>false</enabled></snapshots>\n     <releases><enabled>true</enabled></releases>\n   </repository>\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"2- Add MapR Streams libraries")),(0,i.kt)("p",null,"In the ",(0,i.kt)("inlineCode",{parentName:"p"},"<dependencies>")," element:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"}," <dependency>\n   <groupId>com.mapr.streams</groupId>\n   <artifactId>mapr-streams</artifactId>\n   <version>5.2.0-mapr</version>\n </dependency>\n <dependency>\n   <groupId>org.apache.kafka</groupId>\n   <artifactId>kafka-clients</artifactId>\n   <version>0.9.0.0-mapr-1602</version>\n </dependency>\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"3- Add Flink Kafka Connector libraries")),(0,i.kt)("p",null,"As a first step, we have to add the Flink Kafka connector as a dependency so that we can use the Kafka sink. Add this to the pom.xml file in the dependencies section:"),(0,i.kt)("p",null,"You must add now the Flink Kafka Connector dependency to use the Kafka sink. Add the following entry in the ",(0,i.kt)("inlineCode",{parentName:"p"},"<dependencies>")," element:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"}," <dependency>\n      <groupId>org.apache.flink</groupId>\n      <artifactId>flink-connector-kafka-0.9_2.10</artifactId>\n      <version>${flink.version}</version>\n </dependency>\n")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"4- Exclude Kafka Client to allow use of MapR Streams Client")),(0,i.kt)("p",null,"As you may know, MapR Streams uses the Kafka 0.9.0 API to produce and consume messages. So we need now to remove (exclude) tha Apache Kafka Client API to be sure that Flink use MapR Streams."),(0,i.kt)("p",null,"In the Flink Kafka Connector dependency add the following exclusion:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"  <dependency>\n    <groupId>org.apache.flink</groupId>\n    <artifactId>flink-connector-kafka-0.9_2.10</artifactId>\n    <version>${flink.version}</version>\n      <exclusions>\n        <exclusion>\n          <groupId>org.apache.kafka</groupId>\n          <artifactId>kafka-clients</artifactId>\n        </exclusion>\n        <exclusion>\n          <groupId>org.apache.kafka</groupId>\n          <artifactId>kafka_2.10</artifactId>\n        </exclusion>\n      </exclusions>\n  </dependency>\n")),(0,i.kt)("p",null,"The Flink project is now ready to use the DataStream using the Kafka Connector so you can send and receive messages from MapR Streams."),(0,i.kt)("p",null,"Let\u2019s now create a Stream in MapR and write some simple Flink code to use it."),(0,i.kt)("h2",{id:"create-the-mapr-streams-and-topic"},"Create the MapR Streams and Topic"),(0,i.kt)("p",null,"A stream is a collection of topics that you can manage as a group by:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Setting security policies that apply to all topics in that stream"),(0,i.kt)("li",{parentName:"ol"},"Setting a default number of partitions for each new topic that is created in the stream"),(0,i.kt)("li",{parentName:"ol"},"Set a time-to-live for messages in every topic in the stream")),(0,i.kt)("p",null,"You can find more information about MapR Streams concepts in the ",(0,i.kt)("a",{parentName:"p",href:"http://maprdocs.mapr.com/51/MapR_Streams/concepts.html"},"documentation"),"."),(0,i.kt)("p",null,"On your Mapr Cluster or Sandbox run the following commands: "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ maprcli stream create -path /apps/application-stream -produceperm p -consumeperm p -topicperm p\n$ maprcli stream topic create -path /apps/application-stream -topic flink-demo \n")),(0,i.kt)("h3",{id:"install-and-use-mapr-kafka-utilities"},"Install and use MapR Kafka utilities"),(0,i.kt)("p",null,"Install ",(0,i.kt)("inlineCode",{parentName:"p"},"the mapr-kafka")," package on your cluster :"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"yum install mapr-kafka\n")),(0,i.kt)("p",null,"Open two terminal windows and run the producer and consumer kafka utilities using the following commands:"),(0,i.kt)("p",null,"Producer"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"/opt/mapr/kafka/kafka-0.9.0/bin/kafka-console-producer.sh --broker-list this.will.be.ignored:9092 --topic /apps/application-stream:flink-demo\n")),(0,i.kt)("p",null,"Consumer"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"/opt/mapr/kafka/kafka-0.9.0/bin/kafka-console-consumer.sh --new-consumer --bootstrap-server this.will.be.ignored:9092 --topic /apps/application-stream:flink-demo\n")),(0,i.kt)("p",null,"In the producer window, you can post some messages and see them in the consumer windows. We will use these tools to follow the interactions between MapR Streams and Flink."),(0,i.kt)("h2",{id:"write-your-flink-application"},"Write your Flink application"),(0,i.kt)("p",null,"Let\u2019s now use the Flink Kafka Connector to send messages to MapR Streams and consume them."),(0,i.kt)("h3",{id:"producer"},"Producer"),(0,i.kt)("p",null,"The producer generates messages using the ",(0,i.kt)("inlineCode",{parentName:"p"},"SimpleStringGenerator()")," class and send the string to the ",(0,i.kt)("inlineCode",{parentName:"p"},"/apps/application-stream:flink-demo")," topic."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'  public static void main(String[] args) throws Exception {\n    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\n    Properties properties = new Properties();\n    // properties.setProperty("bootstrap.servers", "<kafka-broker>:9092"); // not used by MapR Streams\n    properties.setProperty("streams.buffer.max.time.ms", "200");\n\n    DataStream<String> stream = env.addSource(new SimpleStringGenerator());\n    stream.addSink(new FlinkKafkaProducer09<>("/apps/application-stream:flink-demo", new SimpleStringSchema(), properties));\n\n    env.execute();\n  }\n    \n')),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"SimpleStringGenerator()")," method code is available ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/mapr-demos/mapr-streams-flink-demo/blob/master/src/main/java/com/mapr/demos/WriteToKafka.java#L46-L61"},"here"),"."),(0,i.kt)("p",null,"The main steps are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"create a new ",(0,i.kt)("inlineCode",{parentName:"li"},"StreamExecutionEnvironment")," the basis of any Flink application"),(0,i.kt)("li",{parentName:"ul"},"create a new ",(0,i.kt)("inlineCode",{parentName:"li"},"DataStream")," in the application environment, the ",(0,i.kt)("inlineCode",{parentName:"li"},"SimpleStringGenerator")," class implements the ",(0,i.kt)("inlineCode",{parentName:"li"},"[SourceFunction](https://ci.apache.org/projects/flink/flink-docs-release-1.1/api/java/)")," the base interface for all streams data sources in Flink."),(0,i.kt)("li",{parentName:"ul"},"add the ",(0,i.kt)("inlineCode",{parentName:"li"},"FlinkKafkaProducer09")," sink to the streams; since MapR Streams is based on Kafka API 0.9, it is possible to use the FlinkKafkaProducer09 class; with 2 small differences:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"the broker list (first parameter) is not used since MapR Streams use the cluster location defined in the ",(0,i.kt)("inlineCode",{parentName:"li"},"/opt/mapr/conf/mapr-clusters.conf")," class."),(0,i.kt)("li",{parentName:"ul"},"the topic name include the path and name of the MapR Stream stream in which the topic is located for example ",(0,i.kt)("inlineCode",{parentName:"li"},"/apps/application-stream:flink-demo"))))),(0,i.kt)("h3",{id:"consumer"},"Consumer"),(0,i.kt)("p",null,"The consumer simply reads the messages from the ",(0,i.kt)("inlineCode",{parentName:"p"},"/apps/application-stream:flink-demo")," topic, and print them into the console."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},'  public static void main(String[] args) throws Exception {\n    // create execution environment\n    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();\n\n    Properties properties = new Properties();\n    // properties.setProperty("bootstrap.servers", "<kafka-broker>:9092"); // not used by MapR Streams\n    properties.setProperty("group.id", "flink_consumer");\n\n    DataStream<String> stream = env.addSource(new FlinkKafkaConsumer09<>(\n        "/apps/application-stream:flink-demo", new SimpleStringSchema(), properties) );\n\n    stream.map(new MapFunction<String, String>() {\n      private static final long serialVersionUID = -6867736771747690202L;\n\n      @Override\n      public String map(String value) throws Exception {\n        return "Stream Value: " + value;\n      }\n    }).print();\n\n    env.execute();\n  }\n')),(0,i.kt)("p",null,"The main steps are:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"create a new ",(0,i.kt)("inlineCode",{parentName:"li"},"StreamExecutionEnvironment")," the basis of any Flink application"),(0,i.kt)("li",{parentName:"ul"},"create a set of properties with the consumer information, in this application we can only set the consumer ",(0,i.kt)("inlineCode",{parentName:"li"},"group.id"),". Note that the ",(0,i.kt)("inlineCode",{parentName:"li"},"bootstrap.servers")," property is not used by MapR Streams, so no need to set it."),(0,i.kt)("li",{parentName:"ul"},"use the ",(0,i.kt)("inlineCode",{parentName:"li"},"FlinkKafkaConsumer09")," to get the message from the MapR Streams topic ",(0,i.kt)("inlineCode",{parentName:"li"},"/apps/application-stream:flink-demo"))),(0,i.kt)("h2",{id:"build-and-run-the-application"},"Build and Run the application"),(0,i.kt)("p",null,"Let\u2019s run the application directly from Maven (or from your favorite IDE)."),(0,i.kt)("p",null,"1- Build the project:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ mvn clean package\n")),(0,i.kt)("p",null,"2- Run the Flink Producer Job"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ mvn exec:java -Dexec.mainClass=com.mapr.demos.WriteToKafka\n")),(0,i.kt)("p",null,"3- Run the Flink Consumer Job"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"$ mvn exec:java -Dexec.mainClass=com.mapr.demos.ReadFromKafka\n")),(0,i.kt)("p",null,"In the terminal, you should see the messages generated from the producer"),(0,i.kt)("p",null,"You can now deploy and execute this job on your Flink cluster."),(0,i.kt)("h2",{id:"conclusion"},"Conclusion"),(0,i.kt)("p",null,"In this article you have learned how to use Flink with MapR Streams to write and read data streams. The key element is the configuration of the Maven Dependencies to configure the project to use MapR Streams libraries instead of Kafka ones."),(0,i.kt)("p",null,"This was originally published on the ",(0,i.kt)("a",{parentName:"p",href:"https://www.mapr.com/blog/getting-started-apache-flink-and-mapr-streams"},"MapR blog here"),"."),(0,i.kt)("p",null,'Learn about what Apache Flink can do and how it maintains consistency and provides flexibility in the "',(0,i.kt)("a",{parentName:"p",href:"https://www.mapr.com/introduction-to-apache-flink"},"Introduction to Apache Flink"),'" ebook.'))}u.isMDXComponent=!0}}]);