(self.webpackChunktgrall_blog=self.webpackChunktgrall_blog||[]).push([[55357],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return u},kt:function(){return m}});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),c=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):s(s({},t),e)),n},u=function(e){var t=c(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),h=c(n),m=o,b=h["".concat(l,".").concat(m)]||h[m]||p[m]||r;return n?a.createElement(b,s(s({ref:t},u),{},{components:n})):a.createElement(b,s({ref:t},u))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,s=new Array(r);s[0]=h;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:o,s[1]=i;for(var c=2;c<r;c++)s[c]=n[c];return a.createElement.apply(null,s)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},54784:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return l},metadata:function(){return c},assets:function(){return u},toc:function(){return p},default:function(){return m}});var a=n(22122),o=n(19756),r=(n(67294),n(3905)),s=["components"],i={title:"Oracle Web Services: Sharing Session between client calls",categories:"ws java"},l=void 0,c={permalink:"/blog/2007/02/15/oracle-web-services-sharing-session-between-client-calls",editUrl:"https://github.dev/tgrall/tgrall.github.io/blob/main/blog/2007-02-15-oracle-web-services-sharing-session-between-client-calls.md",source:"@site/blog/2007-02-15-oracle-web-services-sharing-session-between-client-calls.md",title:"Oracle Web Services: Sharing Session between client calls",description:"OracleAS Web Services Runtime provides a support for stateful Web Services that is based on HTTP /Servlet session. Some people will probably say that Web Services should not be stateful, or at least not based on the protocol... However, today most of Web Services are using HTTP, and in some specific cases it is very useful to be able to have a state.",date:"2007-02-15T00:00:00.000Z",formattedDate:"February 15, 2007",tags:[],readingTime:3.04,truncated:!1,authors:[],prevItem:{title:"Oracle Application Server 10gR3: iHat",permalink:"/blog/2007/02/15/oracle-application-server-10gr3-ihat"},nextItem:{title:"New Groovy Plugin for Oracle JDeveloper 10g",permalink:"/blog/2007/02/07/new-groovy-plugin-for-oracle-jdeveloper-10g"}},u={authorsImageUrls:[]},p=[],h={toc:p};function m(e){var t=e.components,n=(0,o.Z)(e,s);return(0,r.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"OracleAS Web Services Runtime provides a support for stateful Web Services that is based on HTTP /Servlet session. Some people will probably say that Web Services should not be stateful, or at least not based on the protocol... However, today most of Web Services are using HTTP, and in some specific cases it is very useful to be able to have a state."),(0,r.kt)("p",null,"In this post, I am not explaining how to enable stateful services and clients, since it is documented in the ",(0,r.kt)("a",{parentName:"p",href:"http://download.oracle.com/docs/cd/B31017_01/web.1013/b28974/devjavaclass.htm#BEIDDAFG"},"Java Classes and Stateful Web Wervices")," chapter of the developer guide. Here I am show you how you can using client side programming share the same state (session) between different web services calls (even different services running in the same server side application)."),(0,r.kt)("p",null,"The tip used here is about the association of cookies to the client instance (JAX-WS Stub or Call object). Here the code you have to write to do that using DII, will be very similar when using static Stub"),(0,r.kt)("p",null,"1- Enable the state management"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'...\nService service = sf.createService(qName);\nQName port = new QName("CartService");\nCall call = service.createCall(port);\ncall.setProperty(Stub.SESSION_MAINTAIN_PROPERTY, Boolean.valueOf(true));  // this is necessary to be able to manipulate cookie\n...\n\n')),(0,r.kt)("p",null," 2- Create a Map that contains the Cookies and assign it to the call (or Stub)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"\n...\n Map cookieMap = new HashMap();\ncall.setProperty(ClientConstants.COOKIE_MAP, cookieMap);\n...\n\n")),(0,r.kt)("p",null,"This specific step associates a map that will contains all the cookie with the call/stub instance. You will be able then to manipulate the Map to get or set the cookies."),(0,r.kt)("p",null," 3- How to get the ",(0,r.kt)("inlineCode",{parentName:"p"},"JSESSION")," cookie"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},'private Cookie getJSessionCookie(Call call) {\n  Map cookies = (Map)call.getProperty(ClientConstants.COOKIE_MAP);\n\n  if (cookies != null && !cookies.isEmpty()) {\n    Iterator it =  cookies.values().iterator();\n    while (it.hasNext()) {\n      Cookie cookie = (Cookie)it.next();\n      if (cookie.getName().equals("JSESSIONID")) {\n        return cookie;\n      }\n    }\n  }\n\n  return null;\n}\n')),(0,r.kt)("p",null,"Note that the Cookie object is an instance of Oracle ",(0,r.kt)("inlineCode",{parentName:"p"},"HTTPClient.Cookie"),"."),(0,r.kt)("p",null,"4- Utilizing the Cookie"),(0,r.kt)("p",null,"So now you have all the information to be able to get the Session information when the stateful conversation has started;"),(0,r.kt)("p",null,"In this example each time the call.invoke() is done, a counter is incremented on the server."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"Call call = service.createCall(port);\ncall.setProperty(Stub.SESSION_MAINTAIN_PROPERTY, Boolean.valueOf(true));  // this is necessary to be able to manipulate cookie\nMap cookieMap = new HashMap();\ncall.setProperty(ClientConstants.COOKIE_MAP, cookieMap);\n... // The session will only be created after the first invoke\ncall.invoke(...); // counter = 1 call.invoke(...); // counter = 2 since on the same session\n\n... // the session is now created so you can get the cookie\nCookie mySession = getJSessionCookie(call)\n...\n")),(0,r.kt)("p",null,"You can now use the cookie in another call using the following code:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java"},"mySession ..  // was extracted from the call #1\n...// now I am creating a new call instance (myNewCall) that could be in another class\nCall myNewCall = service.createCall(port);\nmyNewCall.setProperty(Stub.SESSION_MAINTAIN_PROPERTY, Boolean.valueOf(true));  // this is necessary to be able to manipulate cookie\nMap cookieMap = new HashMap();\n// add the cookie to the map this will add the cookie to the HTTP request so it will be associated to the same session (/state)\ncookieMap.put(mySession,mySession);// associate the cookie Map to the call\nmyNewCall.setProperty(ClientConstants.COOKIE_MAP, cookieMap);\n...\nmyNewCall.invoke;  // counter = 3 since we share the same session\n...\n\n")),(0,r.kt)("p",null,"Using this sample you have 2 instances of a client calling a service and reusing the same session -state-.  You can also use the same approach to have 2 different clients talking to different services and share the same session. To do that you will have on the server side to use the HTTP Session directly to store your data between calls, and share it between services."))}m.isMDXComponent=!0}}]);