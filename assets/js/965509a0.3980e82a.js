"use strict";(self.webpackChunktgrall_blog=self.webpackChunktgrall_blog||[]).push([[33218],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),c=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},h=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),h=c(n),m=a,d=h["".concat(s,".").concat(m)]||h[m]||u[m]||r;return n?o.createElement(d,i(i({ref:t},p),{},{components:n})):o.createElement(d,i({ref:t},p))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var c=2;c<r;c++)i[c]=n[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}h.displayName="MDXCreateElement"},52212:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return c},assets:function(){return p},toc:function(){return u},default:function(){return m}});var o=n(87462),a=n(63366),r=(n(67294),n(3905)),i=["components"],l={title:"What to do if your Couchbase Server does not start?",categories:"nosql couchbase windows"},s=void 0,c={permalink:"/blog/2012/12/26/what-to-do-if-your-couchbase-server-does-not-start",editUrl:"https://github.dev/tgrall/tgrall.github.io/blob/main/blog/2012-12-26-what-to-do-if-your-couchbase-server-does-not-start.md",source:"@site/blog/2012-12-26-what-to-do-if-your-couchbase-server-does-not-start.md",title:"What to do if your Couchbase Server does not start?",description:"Working with the Couchbase 2.0.0 release you may have issues when trying to access the Web Admin Console or simply starting the server. This is due to the way Couchbase Server uses the IP address/hostname during the installation process. So when you have one of the following errors :",date:"2012-12-26T00:00:00.000Z",formattedDate:"December 26, 2012",tags:[],readingTime:5.305,truncated:!0,authors:[],prevItem:{title:"Couchbase 101: Create views (MapReduce) from your Java application",permalink:"/blog/2012/12/30/couchbase-101-create-views-mapreduce-from-your-java-application"},nextItem:{title:"New Adventure...",permalink:"/blog/2012/12/01/new-adventure-dot-dot-dot"}},p={authorsImageUrls:[]},u=[{value:"Setting up a hostname in hosts file",id:"setting-up-a-hostname-in-hosts-file",children:[]},{value:"Configure Couchbase to use the hostname or new IP address",id:"configure-couchbase-to-use-the-hostname-or-new-ip-address",children:[]}],h={toc:u};function m(e){var t=e.components,n=(0,a.Z)(e,i);return(0,r.kt)("wrapper",(0,o.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"Working with the Couchbase 2.0.0 release you may have issues when trying to access the Web Admin Console or simply starting the server. This is due to the way Couchbase Server uses the IP address/hostname during the installation process. So when you have one of the following errors :"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"On Windows, Server is not working at all, even after installation. You can access the sever on port 8092 (Couchbase API port), but cannot on port 8091"),(0,r.kt)("li",{parentName:"ul"},"You have the following error when accessing the console ",(0,r.kt)("inlineCode",{parentName:"li"},"\"[10:02:02] IP address seems to have changed. Unable to listen on 'ns_1@10.0.2.15'\""))),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"http://2.bp.blogspot.com/-OXj1bGEZTGg/UNs8QBx6X-I/AAAAAAAAAaI/TproFMOQXcE/s320/cb-20-ip-address-error.png",alt:null})),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"When you try to restart the server it does not start and you have the following error message in the error log :\n",(0,r.kt)("inlineCode",{parentName:"li"},"\"Configured address '10.0.2.15' seems to be invalid. Will refuse to start for safety reasons\""))),(0,r.kt)("p",null,"Some of these issues are related to a known issue on Windows ( see ",(0,r.kt)("a",{parentName:"p",href:"http://www.couchbase.com/issues/browse/MB-7417"},"MB-7417")," that will be fixed in 2.0.1) or the fact that Couchbase server does not support change of the IP address after installation.  This is documented in the section \u201c",(0,r.kt)("a",{parentName:"p",href:"http://www.couchbase.com/docs/couchbase-manual-2.0/couchbase-bestpractice-cloud-ip.html"},"Using Couchbase in the Cloud: Handling Changes in IP Addresses"),"\u201d of the Couchbase Server Manual. This article explains what should be done when configuring Couchbase Server on Windows, but you can do equivalent steps on any platform using the shell scripts available on Linux and/or Mac OS X."),(0,r.kt)("p",null,"Once you have installed Couchbase, you can see in the console that the IP address of your server is used :\n",(0,r.kt)("img",{parentName:"p",src:"http://3.bp.blogspot.com/-7wJEnnsZNlA/ULzAYBU09tI/AAAAAAAAAZk/PxZGdUbqo6k/s320/Screen+Shot+2012-12-03+at+4.07.03+PM.png",alt:null})),(0,r.kt)("p",null,"Typically the address 192.168.0.97 is stored in the configuration of Couchbase. If your server receives a new address from the DHCP server, Couchbase will not work anymore. In this article you will see how you can configure Couchbase to use another IP address or Hostname."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Important:")," The steps that follow will completely destroy any data and configuration from the node, so it is best to start with a fresh Couchbase install. If you can not, you should backup your data using the file based backup-restore documented ",(0,r.kt)("a",{parentName:"p",href:"http://www.couchbase.com/docs/couchbase-manual-2.0/couchbase-backup-restore.html"},"here"),"."),(0,r.kt)("h3",{id:"setting-up-a-hostname-in-hosts-file"},"Setting up a hostname in hosts file"),(0,r.kt)("p",null,"The best practice is to register Couchbase using a hostname instead of an IP Address. For this you will need to associate this hostname to an IP address in the ",(0,r.kt)("inlineCode",{parentName:"p"},"hosts")," file."),(0,r.kt)("p",null,"Since the ",(0,r.kt)("inlineCode",{parentName:"p"},"hosts")," file is part of the system, ",(0,r.kt)("em",{parentName:"p"},"you need to edit it as administrator"),". You have different approaches to achieve this:"),(0,r.kt)("p",null,"The following steps explain the easiest way to do it:  "),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Click \u201cStart Menu\u201d"),(0,r.kt)("li",{parentName:"ol"},"Navigate to \u201cAll Programs ",">"," Accessories\u201d"),(0,r.kt)("li",{parentName:"ol"},"\u201cRight Click\u201d on \u201cNotepad\u201d (or your favorite text editor)"),(0,r.kt)("li",{parentName:"ol"},"Click \u201cRun as Administrator\u201d")),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"http://4.bp.blogspot.com/-gxd-rAWLqd8/ULy-vIxak3I/AAAAAAAAAZc/00pNi3Iu0uc/s320/Screen+Shot+2012-12-03+at+3.57.16+PM.png",alt:null})),(0,r.kt)("p",null,"You can now open the file ",(0,r.kt)("inlineCode",{parentName:"p"},"C:\\Windows\\System21\\drivers\\etc\\hosts")),(0,r.kt)("p",null,"Add a new entry with a host name that will be used by Couchbase Server for example something like :"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"127.0.0.1    couchbase-node1.mycompany.com")),(0,r.kt)("p",null,"Here I am using the local address (127.0.0.1) like that I won't have to change it even when my IP address changes. (This is useful when you are working in a single node mode)"),(0,r.kt)("h3",{id:"configure-couchbase-to-use-the-hostname-or-new-ip-address"},"Configure Couchbase to use the hostname or new IP address"),(0,r.kt)("p",null,"During the installation Couchbase has been registered as a Windows Service. To be able to associate Couchbase to the new hostname (or IP address) the service needs to re-configured and reinstalled."),(0,r.kt)("p",null,"This could be done using the scripts provided with the product. To run the scripts you need to do it as administrators, you can do it with one of the following methods:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Search for the file and right click and select ",(0,r.kt)("inlineCode",{parentName:"li"},"Run as Administrator")," (documented below)"),(0,r.kt)("li",{parentName:"ul"},"Run the terminal as administrator and run all the command from there (documented below)"),(0,r.kt)("li",{parentName:"ul"},"Search for the file and run it using ",(0,r.kt)("inlineCode",{parentName:"li"},"Ctrl+Shift+Enter"))),(0,r.kt)("h4",{id:"option-1--using-the-start-menu-and-search-program"},"Option 1 : Using the Start Menu and Search Program"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Stop Couchbase Server Windows Service")),(0,r.kt)("p",null,"The first thing to do, is to stop this service that is automatically started after the installation:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Click ",(0,r.kt)("inlineCode",{parentName:"li"},"Start Menu")),(0,r.kt)("li",{parentName:"ol"},"Type ",(0,r.kt)("inlineCode",{parentName:"li"},"Services")," in the Search Program form"),(0,r.kt)("li",{parentName:"ol"},"Click on ",(0,r.kt)("inlineCode",{parentName:"li"},"Services")),(0,r.kt)("li",{parentName:"ol"},"In the Services Application navigate to ",(0,r.kt)("inlineCode",{parentName:"li"},"CouchbaseServer")),(0,r.kt)("li",{parentName:"ol"},"Right Click and Click on ",(0,r.kt)("inlineCode",{parentName:"li"},"Stop")),(0,r.kt)("li",{parentName:"ol"},"Couchbase is now stopped.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Edit the Service Register script")),(0,r.kt)("p",null,"Note: Due to a small formatting issue (See ",(0,r.kt)("a",{parentName:"p",href:"http://www.couchbase.com/issues/browse/MB-7322"},"MB-7322"),"), Notepad could not be used, a solution is to take ",(0,r.kt)("a",{parentName:"p",href:"http://notepad-plus-plus.org/"},"Notepad++")," or any other advanced editing tool."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"As Administrator, open the ",(0,r.kt)("inlineCode",{parentName:"li"},"C:\\Program Files\\Couchbase\\Server\\bin\\service_register.bat")," file with your favorite editor. To open the editor as Administrator you can use the approach described in the previous step."),(0,r.kt)("li",{parentName:"ol"},"Edit the line 9 to replace ",(0,r.kt)("inlineCode",{parentName:"li"},"%IP_ADDR%")," by your hostname, the line should look like: ",(0,r.kt)("inlineCode",{parentName:"li"},"NS_NAME=ns_1@couchbase-node1.mycompany.com")),(0,r.kt)("li",{parentName:"ol"},"Save the file")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Delete existing configuration and logs")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Using the file explorer, go into: ",(0,r.kt)("inlineCode",{parentName:"li"},"C:\\Program Files\\Couchbase\\Server\\var\\lib\\couchbase\\mnesia")),(0,r.kt)("li",{parentName:"ol"},"Delete its content (Select All and Right Click)")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Register the new Configuration as Service")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Using the file explorer, go into: ",(0,r.kt)("inlineCode",{parentName:"li"},"C:\\Program Files\\Couchbase\\Server\\bin")),(0,r.kt)("li",{parentName:"ol"},"Right Click on ",(0,r.kt)("inlineCode",{parentName:"li"},"service_reregister.bat")),(0,r.kt)("li",{parentName:"ol"},"Click on ",(0,r.kt)("inlineCode",{parentName:"li"},"Run as Administrator"))),(0,r.kt)("p",null,"This script recreates the Couchbase Server Windows Service and starts it automatically."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Check the configuration")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Launch your Internet Browser"),(0,r.kt)("li",{parentName:"ol"},"Go to http://localhost:8091"),(0,r.kt)("li",{parentName:"ol"},"Follow the Couchbase Installation Steps"),(0,r.kt)("li",{parentName:"ol"},"Once install connect to the console"),(0,r.kt)("li",{parentName:"ol"},"Go to ",(0,r.kt)("inlineCode",{parentName:"li"},"Server Nodes")," tab"),(0,r.kt)("li",{parentName:"ol"},"Check that the server name is now ",(0,r.kt)("inlineCode",{parentName:"li"},"couchbase-node1.mycompany.com"))),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"http://3.bp.blogspot.com/-tAn4jv_cdrk/ULzOA53roDI/AAAAAAAAAZ0/r8gts5uSdbU/s320/Screen+Shot+2012-12-03+at+5.06.07+PM.png",alt:null})),(0,r.kt)("p",null,"Your Couchbase node is now configured to use the hostname of your server."),(0,r.kt)("h4",{id:"option-2--using-the-command-line"},"Option 2 : Using the Command Line"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Launch Command Prompt as Administrator")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Click ",(0,r.kt)("inlineCode",{parentName:"li"},"Start Menu")),(0,r.kt)("li",{parentName:"ol"},"Type ",(0,r.kt)("inlineCode",{parentName:"li"},"Command Prompt")," in the Search program form"),(0,r.kt)("li",{parentName:"ol"},"Type ",(0,r.kt)("inlineCode",{parentName:"li"},"Ctrl+Shift+Enter")),(0,r.kt)("li",{parentName:"ol"},"Go to ",(0,r.kt)("inlineCode",{parentName:"li"},"C:\\Program Files\\Couchbase\\Server\\bin")," (or other location if you have chosen another location during installation)")),(0,r.kt)("p",null,"You are now ready to do the administration tasks."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Execute the ",(0,r.kt)("inlineCode",{parentName:"p"},"service_stop.bat"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Edit the Service Register script")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Open ",(0,r.kt)("inlineCode",{parentName:"p"},"service_register.bat"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Edit the line 9 to replace ",(0,r.kt)("inlineCode",{parentName:"p"},"%IP_ADDR%`` by your hostname (or your IP address), the line should look like: "),"set NS_NAME=",(0,r.kt)("a",{parentName:"p",href:"mailto:ns_1@couchbase-node1.mycompany.com"},"ns_1@couchbase-node1.mycompany.com"),"`")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Save the file3.  Delete the content of: ",(0,r.kt)("inlineCode",{parentName:"p"},"C:\\Program Files\\Couchbase\\Server\\var\\lib\\couchbase\\mnesia"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Execute the `service_reregister.bat"))),(0,r.kt)("p",null,"This script recreates the Couchbase Server Windows Service and starts it automatically."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Check the configuration")),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Launch your Internet Browser"),(0,r.kt)("li",{parentName:"ol"},"Go to http://localhost:8091"),(0,r.kt)("li",{parentName:"ol"},"Follow the Couchbase Installation Steps"),(0,r.kt)("li",{parentName:"ol"},"Once install connect to the console"),(0,r.kt)("li",{parentName:"ol"},"Go to ",(0,r.kt)("inlineCode",{parentName:"li"},"Server Nodes")," tab"),(0,r.kt)("li",{parentName:"ol"},"Check that the server name is now ",(0,r.kt)("inlineCode",{parentName:"li"},"couchbase-node1.mycompany.com"))),(0,r.kt)("p",null,(0,r.kt)("img",{parentName:"p",src:"http://3.bp.blogspot.com/-tAn4jv_cdrk/ULzOA53roDI/AAAAAAAAAZ0/r8gts5uSdbU/s320/Screen+Shot+2012-12-03+at+5.06.07+PM.png",alt:null})),(0,r.kt)("p",null,"Your Couchbase node is now configured to use the hostname of your server."))}m.isMDXComponent=!0}}]);