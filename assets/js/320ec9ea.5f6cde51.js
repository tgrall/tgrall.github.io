"use strict";(self.webpackChunktgrall_blog=self.webpackChunktgrall_blog||[]).push([[93078],{3905:(e,t,a)=>{a.d(t,{Zo:()=>c,kt:()=>h});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function r(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?r(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function o(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},r=Object.keys(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)a=r[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var s=n.createContext({}),u=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},c=function(e){var t=u(e.components);return n.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},p=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,c=o(e,["components","mdxType","originalType","parentName"]),p=u(a),h=i,g=p["".concat(s,".").concat(h)]||p[h]||d[h]||r;return a?n.createElement(g,l(l({ref:t},c),{},{components:a})):n.createElement(g,l({ref:t},c))}));function h(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=a.length,l=new Array(r);l[0]=p;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:i,l[1]=o;for(var u=2;u<r;u++)l[u]=a[u];return n.createElement.apply(null,l)}return n.createElement.apply(null,a)}p.displayName="MDXCreateElement"},7979:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>d,frontMatter:()=>r,metadata:()=>o,toc:()=>u});var n=a(87462),i=(a(67294),a(3905));const r={title:"Quarkus: Default Values for Panache Entity Fields",description:"Learn how to set default values for Panache entity fields in Quarkus.",tags:["quarkus","panache","java","orm"],keywords:["quarkus","panache","java","orm"]},l=void 0,o={permalink:"/blog/2023/12/09/quarkus-entity-default-value",editUrl:"https://github.dev/tgrall/tgrall.github.io/blob/main/blog/2023-12-09-quarkus-entity-default-value.md",source:"@site/blog/2023-12-09-quarkus-entity-default-value.md",title:"Quarkus: Default Values for Panache Entity Fields",description:"Learn how to set default values for Panache entity fields in Quarkus.",date:"2023-12-09T00:00:00.000Z",formattedDate:"December 9, 2023",tags:[{label:"quarkus",permalink:"/blog/tags/quarkus"},{label:"panache",permalink:"/blog/tags/panache"},{label:"java",permalink:"/blog/tags/java"},{label:"orm",permalink:"/blog/tags/orm"}],readingTime:3.3,hasTruncateMarker:!0,authors:[],frontMatter:{title:"Quarkus: Default Values for Panache Entity Fields",description:"Learn how to set default values for Panache entity fields in Quarkus.",tags:["quarkus","panache","java","orm"],keywords:["quarkus","panache","java","orm"]},prevItem:{title:"Simplifying Data Generation with GitHub Copilot",permalink:"/blog/2023/12/13/github-copilot-assist-generate-test-data"},nextItem:{title:"Revoke Deploy Keys with GitHub CLI",permalink:"/blog/2023/03/31/revoke-github-deploy-key-org-level"}},s={authorsImageUrls:[]},u=[{value:"Panache Entities and Active Record Pattern",id:"panache-entities-and-active-record-pattern",level:2},{value:"Setting Default Values:",id:"setting-default-values",level:2},{value:"Using Entity Field Declaration",id:"using-entity-field-declaration",level:3},{value:"Using Column Definition",id:"using-column-definition",level:3},{value:"Caveats and Conclusion",id:"caveats-and-conclusion",level:2}],c={toc:u};function d(e){let{components:t,...r}=e;return(0,i.kt)("wrapper",(0,n.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,(0,i.kt)("img",{alt:"Quarkus: Default Values for Panache Entity Fields",src:a(6428).Z,width:"960",height:"502"})),(0,i.kt)("p",null,"In the ever-evolving landscape of database technologies, my journey led me away from Java ORM projects for a decade, exploring the realms of NoSQL databases like MongoDB, Couchbase, Redis, and even HBase."),(0,i.kt)("p",null,"Recently, my focus shifted back to Java and, specifically, Quarkus. In this blog post, I'll share my experience migrating part of my site, windr.org, from MongoDB to PostgreSQL with Quarkus, highlighting how I tackled my first small challenge of ",(0,i.kt)("strong",{parentName:"p"},"setting default values for Panache entity fields"),"."),(0,i.kt)("p",null,"Choosing Quarkus and Panache:"),(0,i.kt)("p",null,"Having dabbled with Quarkus during my time at Red Hat in 2019, I decided to delve deeper into it for my personal projects. While familiar with using MongoDB directly with Node.js, working with Quarkus and RDBMS prompted me to opt for Hibernate ORM with Panache, a Quarkus extension offering a ",(0,i.kt)("a",{parentName:"p",href:"https://quarkus.io/guides/hibernate-orm-panache"},"simplified and user-friendly API for Hibernate ORM"),"."),(0,i.kt)("p",null,"I have published the code of this example on GitHub:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/tgrall/learning-quarkus/tree/main/panache-default-value"},"Learning Quarkus: Default Values for Panache Entity Fields"))),(0,i.kt)("h2",{id:"panache-entities-and-active-record-pattern"},"Panache Entities and Active Record Pattern"),(0,i.kt)("p",null,"Utilizing the ",(0,i.kt)("a",{parentName:"p",href:"https://martinfowler.com/eaaCatalog/activeRecord.html"},"active record pattern"),", I extended the PanacheEntity class, leveraging its built-in methods for persisting, finding, updating, and deleting entities. Taking an example, let's look at the ",(0,i.kt)("inlineCode",{parentName:"p"},"Brand")," entity:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'@Entity\n@Table(name = "brands")\npublic class Brand extends PanacheEntity {\n\n    public String name;\n\n    public String description;\n\n    public String logo;\n\n}\n')),(0,i.kt)("p",null,"As mentioned in the ",(0,i.kt)("a",{parentName:"p",href:"https://quarkus.io/guides/hibernate-orm-panache#panache-entity"},"Quarkus Documentation"),", the ",(0,i.kt)("inlineCode",{parentName:"p"},"PanacheEntity")," class provides the methods to persist, find, update and delete entities."),(0,i.kt)("p",null,"The question that I had was: "),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("em",{parentName:"li"},"how to set default values for the fields of the entity?"))),(0,i.kt)("p",null,"In my case I wanted to set the ",(0,i.kt)("inlineCode",{parentName:"p"},"logo")," field to a default value if it was not set."),(0,i.kt)("h2",{id:"setting-default-values"},"Setting Default Values:"),(0,i.kt)("p",null,"The primary question that arose during this migration was how to set default values for Panache entity fields, specifically the 'logo' field in my case. Two approaches were explored."),(0,i.kt)("h3",{id:"using-entity-field-declaration"},"Using Entity Field Declaration"),(0,i.kt)("p",null,"The simplest method involved assigning a default value directly in the entity field declaration. For instance:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'@Entity\n@Table(name = "brands")\npublic class Brand extends PanacheEntity {\n\n    public String name;\n\n    public String description;\n\n    public String logo = "default-logo.png";\n\n}\n')),(0,i.kt)("p",null,"This method worked seamlessly, providing the desired default value when creating new entities, as you can see with the following test:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'        Brand fanaticWithoutLogo = new Brand();\n        fanaticWithoutLogo.name = "Fanatic";\n        fanaticWithoutLogo.description = "Fanatic Description";\n\n        String fanaticWithoutLogoString = objectMapper.writeValueAsString(fanaticWithoutLogo);\n        given()\n                .body(fanaticWithoutLogoString)\n                .contentType(ContentType.JSON)\n                .accept(ContentType.JSON)\n                .when().post("/api/v1/brands")\n                .then()\n                .statusCode(201)\n                .body(\n                        "name", is(fanaticWithoutLogo.name),\n                        "description", is(fanaticWithoutLogo.description),\n                        "logo", is("default-logo.png")\n                );\n')),(0,i.kt)("p",null,"I wanted also to enforce a default value when I data are inserted directly in the database. For example, when I am using the ",(0,i.kt)("inlineCode",{parentName:"p"},"psql")," command line tool to insert data in the database, or other external tools."),(0,i.kt)("h3",{id:"using-column-definition"},"Using Column Definition"),(0,i.kt)("p",null,"A more complex but schema-focused approach utilized the ",(0,i.kt)("inlineCode",{parentName:"p"},"@Column")," annotation to set the default value:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-java"},'@Entity\n@Table(name = "brands")\npublic class Brand extends PanacheEntity {\n\n    public String name;\n\n    public String description;\n\n    @Column(columnDefinition = "varchar(255) default \'default-logo.png\'")\n    public String logo = "default-logo.png";\n\n}\n')),(0,i.kt)("p",null,"This modify the database schema and add the default value:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sql"},"    create table brands (\n    id bigint not null,\n    description varchar(255),\n    logo varchar(255) default 'default-logo.png',\n    name varchar(255),\n    primary key (id)\n);\n);\n")),(0,i.kt)("h2",{id:"caveats-and-conclusion"},"Caveats and Conclusion"),(0,i.kt)("p",null,"While effective, this approach involved hard-coding the default value in both the code and the database schema, presenting a minor inconvenience."),(0,i.kt)("p",null,"Despite a brief disappointment with the redundancy of the second solution, it proved effective for my current needs. Although ",(0,i.kt)("inlineCode",{parentName:"p"},"@PrePersist")," annotation wasn't explored, it's likely to exhibit similar behavior. If a more elegant solution emerges, I'll be sure to update this post."),(0,i.kt)("p",null,"In sharing this journey, I hope to assist developers navigating similar challenges and contribute to the collective knowledge of the Quarkus community. While these concepts might be second nature for Jakarta Persistence users, they present insightful perspectives for individuals, much like myself, who are reacquainting themselves with Java ORM after a decade immersed in the world of NoSQL development."))}d.isMDXComponent=!0},6428:(e,t,a)=>{a.d(t,{Z:()=>n});const n=a.p+"assets/images/header-815286d3335126d3590550aaf4efb2c9.png"}}]);