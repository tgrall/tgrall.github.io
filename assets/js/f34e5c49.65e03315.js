"use strict";(self.webpackChunktgrall_blog=self.webpackChunktgrall_blog||[]).push([[92351],{3905:function(e,t,n){n.d(t,{Zo:function(){return u},kt:function(){return c}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=p(n),c=r,h=m["".concat(l,".").concat(c)]||m[c]||d[c]||o;return n?a.createElement(h,i(i({ref:t},u),{},{components:n})):a.createElement(h,i({ref:t},u))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},68512:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return p},assets:function(){return u},toc:function(){return d},default:function(){return c}});var a=n(87462),r=n(63366),o=(n(67294),n(3905)),i=["components"],s={title:"MongoDB : Playing with Arrays",categories:"mongodb json arrays lists"},l=void 0,p={permalink:"/blog/2015/04/21/mongodb-playing-with-arrays",editUrl:"https://github.dev/tgrall/tgrall.github.io/blob/main/blog/2015-04-21-mongodb-playing-with-arrays.md",source:"@site/blog/2015-04-21-mongodb-playing-with-arrays.md",title:"MongoDB : Playing with Arrays",description:'As you know,  you have many differences between relational and document databases. The biggest, for the developer, is probably the data model: Row versus Document. This is particularly true when we talk about "relations" versus "embedded documents (or values)". Let\'s look at some examples, then see what are the various operations provided by MongoDB to help you to deal with this.',date:"2015-04-21T00:00:00.000Z",formattedDate:"April 21, 2015",tags:[],readingTime:6.2,truncated:!0,authors:[],prevItem:{title:"Apache Drill : How to create a new function?",permalink:"/blog/2015/07/21/apache-drill-how-to-create-a-new-function"},nextItem:{title:"Introduction to MongoDB Security",permalink:"/blog/2015/02/04/introduction-to-mongodb-security"}},u={authorsImageUrls:[]},d=[{value:"Adding new interest to the user",id:"adding-new-interest-to-the-user",children:[]},{value:"Adding a new item into an order",id:"adding-a-new-item-into-an-order",children:[]},{value:"Updating an item in the order",id:"updating-an-item-in-the-order",children:[]},{value:"Remove an item from the Array",id:"remove-an-item-from-the-array",children:[{value:"Conclusion",id:"conclusion",children:[]}]}],m={toc:d};function c(e){var t=e.components,n=(0,r.Z)(e,i);return(0,o.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,'As you know,  you have many differences between relational and document databases. The biggest, for the developer, is probably the data model: Row versus Document. This is particularly true when we talk about "relations" versus "embedded documents ',(0,o.kt)("em",{parentName:"p"},"(or values)"),"\". Let's look at some examples, then see what are the various operations provided by MongoDB to help you to deal with this."),(0,o.kt)("p",null,'I won\'t use this post to go in all the details about "document design", but I just want to focus on the operations you can to with these arrays/list (so useful operations once you have chosen to embed documents).'),(0,o.kt)("p",null,"Let's use a very simple example based on e-commerce platform, with two document types : ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"user"))," and ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("em",{parentName:"strong"},"orders")),"."),(0,o.kt)("p",null,"The first thing you have, is a simple list of values into a JSON array. Let's look at a user profile where user have a list of interests  (field ",(0,o.kt)("inlineCode",{parentName:"p"},"interested_by"),") :"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "_id" : 654321,\n  "first_name" : "John",\n  "last_name" : "Doe",\n  "interested_by" : [ "electronics", "sports", "music" ],\n  "address" : {\n    "name" : "John Doe",\n    "company" : "Resultri",\n    "street" : "1015 Mapple Street",\n    "city" : "San Francisco",\n    "state" : "CA",\n    "zip_code" : 94105\n  }\n}\n')),(0,o.kt)("p",null,'Another thing you do with array, is to represent "one-to-many" relations. These relations in your RDBMS are based on multiple tables and foreign keys.\nIn document databases, like MongoDB, these relations are, most of the time, represented using an ',(0,o.kt)("em",{parentName:"p"},"array of documents"),", something like (look at the ",(0,o.kt)("inlineCode",{parentName:"p"},"items")," field):"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "_id" : 45218468309,\n  "date" : ISODate("2015-01-28T09:40:50.615Z"),\n  "customer" : {\n    "id" : 654321,\n    "name" : "John Doe"\n  },\n  "ship_to" : {\n    "name" : "John Doe",\n    "company" : "Resultri",\n    "street" : "1015 Mapple Street",\n    "city" : "San Francisco",\n    "state" : "CA",\n    "zip_code" : 94105\n  },\n  "items" : [\n    {\n      "sku" : "WA34R",\n      "description" : "Wireless Qwerty Keyboard",\n      "quantity" : 1,\n      "unit_price" : 41.5,\n      "price" : 41.5,\n      "vat" : 20\n    },\n    {\n      "sku" : "MW003",\n      "description" : "MiWatch",\n      "quantity" : 2,\n      "unit_price" : 245,\n      "price" : 490,\n      "vat" : 20\n    }\n  ]\n}\n\n')),(0,o.kt)("p",null,"Documents above are not necessary complete, I just want to focus on the various operations you can do on these arrays."),(0,o.kt)("p",null,(0,o.kt)("em",{parentName:"p"},"Note: you can add these documents into your MongoDB instance, I will use the collections ",(0,o.kt)("inlineCode",{parentName:"em"},"customers")," and ",(0,o.kt)("inlineCode",{parentName:"em"},"orders"),".")),(0,o.kt)("h3",{id:"adding-new-interest-to-the-user"},"Adding new interest to the user"),(0,o.kt)("p",null,"To achieve this you have 2 operators that you can use in your update: ",(0,o.kt)("a",{parentName:"p",href:"http://docs.mongodb.org/manual/reference/operator/update/push/"},(0,o.kt)("inlineCode",{parentName:"a"},"$push"))," and ",(0,o.kt)("a",{parentName:"p",href:"http://docs.mongodb.org/manual/reference/operator/update/addToSet/"},(0,o.kt)("inlineCode",{parentName:"a"},"$addToSet")),". Since these one a very simple I won't go into too much details."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"$push")," will add the value at the end of the list, if the value already exits it will be added (many copies), this is why it makes sense to use the ",(0,o.kt)("inlineCode",{parentName:"p"},"$addToSet")," operator, that only add the value if the value does not already exist in the array."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'db.customers.update(\n  { "_id" : 654321  },\n  { "$addToSet" : { "interested_by" :  "sports"}  }\n);\n')),(0,o.kt)("p",null,"This update command above ",(0,o.kt)("strong",{parentName:"p"},"will not change"),' the document since the "sports" value is already in the list.'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},'db.customers.update(\n  { "_id" : 654321  },\n  { "$addToSet" : { "interested_by" :  "books"}  }\n);\n')),(0,o.kt)("p",null,"This ",(0,o.kt)("strong",{parentName:"p"},"will add"),' the "books" value at the end of the list.'),(0,o.kt)("p",null,"If the attribute ",(0,o.kt)("inlineCode",{parentName:"p"},"interested_by")," does not exist in the document, it will be added with one single entry (here the ",(0,o.kt)("inlineCode",{parentName:"p"},"$push")," is working the same way )."),(0,o.kt)("p",null,"If the attribute is not an array, the database will not do anything and return the error ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/mongodb/mongo/blob/master/docs/errors.md"},"#16837")," ",(0,o.kt)("em",{parentName:"p"},"\"The field 'first_name' must be an array but is of type String in document\""),"."),(0,o.kt)("p",null,"Here we use ",(0,o.kt)("em",{parentName:"p"},"interest"),", but you can imagine doing the same thing for tagging, or any other business use case with a list of values."),(0,o.kt)("h3",{id:"adding-a-new-item-into-an-order"},"Adding a new item into an order"),(0,o.kt)("p",null,"The previous case, is very simple since it is a scalar value. Now I need to add a new order line, it is not harder than before:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'db.orders.update(\n  { "_id" : 45218468309   },\n  {\n    "$push" : {\n      "items" : {\n        "sku" : "MO001",\n        "description" : "Bluetooth mouse",\n        "quantity" : 1,\n        "unit_price" : 20.00,\n        "price" : 20.00,\n        "vat" : 20.00\n      }\n    }\n  }\n);\n')),(0,o.kt)("p",null,"So you can see now that the value is added at the end of the list."),(0,o.kt)("h3",{id:"updating-an-item-in-the-order"},"Updating an item in the order"),(0,o.kt)("p",null,"Let's look at another requirement. Now I need to update for example the quantity of one of the line. In your relational application it is ",(0,o.kt)("em",{parentName:"p"},"easy")," in the sense that you have one single record to update(in reality it is a different story since application are using complex data layer)."),(0,o.kt)("p",null,"You can do the same, meaning you can only update the ",(0,o.kt)("em",{parentName:"p"},"items")," directly in the array -- (no need to replace the full document or list like I see too often)."),(0,o.kt)("p",null,"For this, you  just need to use the ",(0,o.kt)("inlineCode",{parentName:"p"},"update")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"$set")," and specify the positional operation ",(0,o.kt)("inlineCode",{parentName:"p"},"$"),"."),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"$")," operator is a placeholder for the first entry in the array that match the filter (query document) sent to the update/findAndModify command."),(0,o.kt)("p",null,"In our example, to update a specific line in the order"),(0,o.kt)("p",null,"The proper way is simply to use the an update and ",(0,o.kt)("inlineCode",{parentName:"p"},"$set"),",\nbut you have to select the exact entry in the array in your filter. For example in our case we want to update the number of mouses and the price, this will look like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'db.orders.update(\n  {\n    "_id" : 45218468309,\n    "items.sku" : "MO001"\n  },\n  {\n    "$set" :\n    {\n        "items.$" : {\n          "sku" : "MO001",\n          "description" : "Bluetooth mouse",\n          "quantity" : 2,\n          "unit_price" : 20.00,\n          "price" : 40.00,\n          "vat" : 20.00\n        }\n    }\n  }\n);\n')),(0,o.kt)("p",null,"As you can see, the ",(0,o.kt)("inlineCode",{parentName:"p"},"$")," operator is telling MongoDB to update one specific entry in the array."),(0,o.kt)("h2",{id:"remove-an-item-from-the-array"},"Remove an item from the Array"),(0,o.kt)("p",null,"You have learned so far that you can easily query and add values into an array; using the same appraoch you can also remove entry in an array. This is done using 3 operators : ",(0,o.kt)("inlineCode",{parentName:"p"},"$pop"),", ",(0,o.kt)("inlineCode",{parentName:"p"},"$pull")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"$pullAll")),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("inlineCode",{parentName:"li"},"$pop")," operator removes one element from the end of the array"),(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("inlineCode",{parentName:"li"},"$pull")," operator removes ",(0,o.kt)("em",{parentName:"li"},"all")," elements in the array that match a specified value."),(0,o.kt)("li",{parentName:"ul"},"The ",(0,o.kt)("inlineCode",{parentName:"li"},"$pullAll")," operator removes ",(0,o.kt)("em",{parentName:"li"},"all")," elements in the array that match any of the specified values.")),(0,o.kt)("h4",{id:"remove-some-interests-from-a-customer"},"Remove some interests from a customer"),(0,o.kt)("p",null,'For example, let\'s remove the "electronics" interest from the customer id 654321.'),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'db.customers.update(\n  { "_id" : 654321  },\n  { "$pull" : { "interested_by" :  "electronics"}  }\n);\n\n')),(0,o.kt)("p",null,"If you want to remove sports and music interest from the customer you can use the ",(0,o.kt)("inlineCode",{parentName:"p"},"$pullAll")," operator as follow:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'db.customers.update(\n  { "_id" : 654321  },\n  { "$pullAll" : { "interested_by" :  ["sports","music"]}  }\n);\n\n')),(0,o.kt)("p",null,"Here we use ",(0,o.kt)("em",{parentName:"p"},"interest"),", but you can imagine doing the same thing for tagging, or any other business use case with a list of values."),(0,o.kt)("h4",{id:"remove-item-into-an-order"},"Remove item into an order"),(0,o.kt)("p",null,"Using the same operator you can also remove a line order (item) from an order document, for example let's remove the line with the item MO001 (Bluetooth mouse). For this we can use the ",(0,o.kt)("inlineCode",{parentName:"p"},"$pull")," operator with the proper sku."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js"},'db.orders.update(\n  {\n    "_id" : 45218468309,\n  },\n  {\n    "$pull" : { "items" : { "sku" : "MO001" } }\n  }\n);\n\n')),(0,o.kt)("h3",{id:"conclusion"},"Conclusion"),(0,o.kt)("p",null,"In this article you have learn how to create/edit arrays in JSON documents."),(0,o.kt)("p",null,"In addition to all the update operators, MongoDB provides many operators for querying arrays such as  ",(0,o.kt)("a",{parentName:"p",href:"http://docs.mongodb.org/manual/reference/operator/query/size/"},"$size")," or ",(0,o.kt)("a",{parentName:"p",href:"http://docs.mongodb.org/manual/reference/operator/query/elemMatch/"},(0,o.kt)("inlineCode",{parentName:"a"},"$elemMatch")),"."))}c.isMDXComponent=!0}}]);