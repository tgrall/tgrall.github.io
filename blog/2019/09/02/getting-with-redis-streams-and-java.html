<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Tug&#39;s Site Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Tug&#39;s Site Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-1520374-2","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Getting Started with Redis Streams and Java | Tug&#x27;s Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://tgrall.github.io/blog/2019/09/02/getting-with-redis-streams-and-java"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Getting Started with Redis Streams and Java | Tug&#x27;s Site"><meta data-react-helmet="true" name="description" content="As you may have seen, I have joined Redis Labs a month ago; one of the first task as a new hire is to learn more about Redis. So I learned, and I am still learning."><meta data-react-helmet="true" property="og:description" content="As you may have seen, I have joined Redis Labs a month ago; one of the first task as a new hire is to learn more about Redis. So I learned, and I am still learning."><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2019-09-02T00:00:00.000Z"><meta data-react-helmet="true" property="article:tag" content="redis,nosql,stream,streaming,java"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://tgrall.github.io/blog/2019/09/02/getting-with-redis-streams-and-java"><link data-react-helmet="true" rel="alternate" href="https://tgrall.github.io/blog/2019/09/02/getting-with-redis-streams-and-java" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://tgrall.github.io/blog/2019/09/02/getting-with-redis-streams-and-java" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.acbe81c6.css">
<link rel="preload" href="/assets/js/runtime~main.69db4c69.js" as="script">
<link rel="preload" href="/assets/js/main.f5c6966c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Tug&#x27;s Site</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/talks">Talks</a></div><div class="navbar__items navbar__items--right"><a href="https://windr.org" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Windsurfing App<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/tgrall/tgrall.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/05/16/simple-caching-service-with-redis">Simple caching service with Redis</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/01/02/how-to-use-ssl-slash-tls-with-redis-enterprise">How to use SSL/TLS with Redis Enterprise</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2019/09/19/redis-rolling-upgrade-on-pivotal-cloud-foundry-pcf">Redis Rolling Upgrade on Pivotal Cloud Foundry (PCF)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2019/09/04/multi-nodes-redis-cluster-with-docker">Multi-Nodes Redis Cluster with Docker</a></li><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/2019/09/02/getting-with-redis-streams-and-java">Getting Started with Redis Streams and Java</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_GeHD" itemprop="headline">Getting Started with Redis Streams and Java</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2019-09-02T00:00:00.000Z" itemprop="datePublished">September 2, 2019</time> Â· 8 min read</div></header><div class="markdown" itemprop="articleBody"><p>As you may have seen, I have joined <a href="https://www.redislabs.com" target="_blank" rel="noopener noreferrer">Redis Labs</a> a month ago; one of the first task as a new hire is to learn more about Redis. So I learned, and I am still learning.</p><p>This is when I discovered <a href="https://redis.io/topics/streams-intro" target="_blank" rel="noopener noreferrer">Redis Streams</a>. I am a big fan of streaming-based applications so it is natural that I start with a small blog post explaining how to use Redis Streams and Java.</p><p><strong><em>What is Redis Streams?</em></strong></p><p>Redis Streams is a Redis Data Type, that represents a log so you can add new information/message in an append-only mode <em>(this is not 100% accurate since you can remove messages from the log)</em>. Using Redis Streams you can build &quot;Kafka Like&quot; applications, what I mean by that you can:</p><ul><li>create applications that publish and consume messages (nothing extraordinary here, you could already do that with Redis Pub/Sub)</li><li>consume messages that are published even when your client application (consumer) is not running. This is a big difference with Redis Pub/Sub</li><li>consume messages starting a specific offset, for example, read the whole history, or only new messages</li></ul><p>In addition to this, Redis Streams has the concept of <strong>Consumer Groups</strong>. Redis Streams Consumer Groups, like Apache Kafka ones, allows the client applications to consume messages in a distributed fashion (multiple clients), providing an easy way to scale and create highly available systems.</p><p><img src="/assets/images/redis-streams-101-img-1-2968c7ae8874c27aa176d161aa05a1d1.png"></p><p>Enroll in the <a href="https://university.redislabs.com/courses/course-v1:redislabs+RU202+2019_03/about" target="_blank" rel="noopener noreferrer">Redis University: Redis Streams</a> to learn more and get certified.</p><p><strong><em>Sample Application</em></strong></p><p>The <a href="https://github.com/tgrall/redis-streams-101-java" target="_blank" rel="noopener noreferrer">redis-streams-101-java GitHub Repository</a> contains sample code that shows how to</p><ul><li>post messages to a streams</li><li>consume messages using a consumer group</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h4><ul><li>Redis 5.x, you have here multiple options:<ul><li><a href="https://redis.io" target="_blank" rel="noopener noreferrer">Download</a> and install Redis Community</li><li>Install and Run a Docker image: <a href="https://hub.docker.com/_/redis" target="_blank" rel="noopener noreferrer">Community</a> or <a href="https://hub.docker.com/r/redislabs/redis" target="_blank" rel="noopener noreferrer">Redis Enterprise</a> </li><li>Create a online instance on <a href="https://redislabs.com/redis-enterprise/essentials/" target="_blank" rel="noopener noreferrer">Redis Labs Cloud</a> (30mb for free)</li></ul></li><li>Java 8 or later</li><li>Apache Maven 3.5.x</li><li>Git</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="java--redis-streams"></a>Java &amp; Redis Streams<a class="hash-link" href="#java--redis-streams" title="Direct link to heading">#</a></h3><p>Redis has many Java clients developed by the community, as you can see on the <a href="https://redis.io/clients#java" target="_blank" rel="noopener noreferrer">Redis.io site</a>.</p><p>It looks, based on my short experience with Redis so far, that the most complete one around Redis Streams support is <a href="https://lettuce.io" target="_blank" rel="noopener noreferrer">Lettuce</a>, this is the one I will be using in the following code.</p><p>####1- Adding Lettuce to Your Maven Project</p><p>Add the following dependency to your project file:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly xml"><pre tabindex="0" class="prism-code language-xml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">io.lettuce</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">groupId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">lettuce-core</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">artifactId</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span><span class="token tag punctuation" style="color:#393A34">&lt;</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain">5.1.8.RELEASE</span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">version</span><span class="token tag punctuation" style="color:#393A34">&gt;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token tag punctuation" style="color:#393A34">&lt;/</span><span class="token tag" style="color:#00009f">dependency</span><span class="token tag punctuation" style="color:#393A34">&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>####2- Connecting to Redis</p><p>Import the following classes</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">import io.lettuce.core.*;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.lettuce.core.api.StatefulRedisConnection;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">import io.lettuce.core.api.sync.RedisCommands;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then connect with:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">RedisClient redisClient = RedisClient.create(&quot;redis://password@host:port&quot;); // change to reflect your environment</span></span><span class="token-line" style="color:#393A34"><span class="token plain">StatefulRedisConnection&lt;String, String&gt; connection = redisClient.connect();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">RedisCommands&lt;String, String&gt; syncCommands = connection.sync();</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>When your application is done with the connection you should disconnect with the following code:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">connection.close();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">redisClient.shutdown();</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>####3- Sending Message to Streams</p><p>Once you have a connection you can send a message. In this example, I will let Redis generate the message ID, which is time-based, and the body will be built using a Map representing IoT data, for example, a weather data capturing Wind speed and direction in real-time.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    public static void main(String[] args) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        RedisClient redisClient = RedisClient.create(&quot;redis://localhost:6379&quot;); // change to reflect your environment</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        StatefulRedisConnection&lt;String, String&gt; connection = redisClient.connect();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        RedisCommands&lt;String, String&gt; syncCommands = connection.sync();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        Map&lt;String, String&gt; messageBody = new HashMap&lt;&gt;();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        messageBody.put( &quot;speed&quot;, &quot;15&quot; );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        messageBody.put( &quot;direction&quot;, &quot;270&quot; );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        messageBody.put( &quot;sensor_ts&quot;, String.valueOf(System.currentTimeMillis()) );</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        String messageId = syncCommands.xadd(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                &quot;weather_sensor:wind&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                messageBody);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println( String.format(&quot;Message %s : %s posted&quot;, messageId, messageBody) );</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        connection.close();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        redisClient.shutdown();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Let me explain the code:</p><ul><li>Lines 3-5 are used to connect to Redis</li><li>Lines 7-10 are used to create the message body, using a Map, since Redis Streams messages are string key/values.</li><li>Lines 12-14 call the <code>syncCommands.xadd()</code> method using the streams key &quot;weather_sensor:wind&quot; and the message body itself<ul><li>this method returns the message ID.</li></ul></li><li>line 16 just print the message ID and content</li><li>the lines 18-19 close the connection and client.</li></ul><p>The complete producer code is available <a href="https://github.com/tgrall/redis-streams-101-java/blob/master/src/main/java/com/kanibl/redis/streams/simple/RedisStreams101Producer.java" target="_blank" rel="noopener noreferrer">here</a>.</p><p>####4- Consuming Messages</p><p>Redis Streams offers various way to consume/read messages using the commands: <a href="https://redis.io/commands/xrange" target="_blank" rel="noopener noreferrer">XRANGE</a>, <a href="https://redis.io/commands/xrevrange" target="_blank" rel="noopener noreferrer">XREVRANGE</a>, <a href="https://redis.io/commands/xread" target="_blank" rel="noopener noreferrer">XREAD</a>, <a href="https://redis.io/commands/xreadgroup" target="_blank" rel="noopener noreferrer">XREADGROUP</a>.</p><p>I want to keep the article short and close to the way you would build an application with Apache Kafka, this is why I will use the <a href="https://redis.io/commands/xreadgroup" target="_blank" rel="noopener noreferrer">XREADGROUP</a> command from Lettuce.</p><p>The Consumer Groups allow developers to create a group of clients that will cooperate to consume messages from the streams (for scale and high availability); it is also a way to associate the client to specific applications roles; for example:</p><ul><li>a consumer group called &quot;data warehouse&quot; will consume messages and send them to a data warehouse</li><li>another consumer group called &quot;aggregator&quot; will consume the messages and aggregate the data and send them to another sink (another stream or storage)</li></ul><p>Each of this group will act independently, and each of this group could have multiple &quot;consumers&quot; (client).</p><p>Let&#x27;s see how you use this in Java.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">...</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        try {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // WARNING: Streams must exist before creating the group</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            //          This will not be necessary in Lettuce 5.2, see https://github.com/lettuce-io/lettuce-core/issues/898</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            syncCommands.xgroupCreate( XReadArgs.StreamOffset.from(&quot;weather_sensor:wind&quot;, &quot;0-0&quot;), &quot;application_1&quot;  );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        catch (RedisBusyException redisBusyException) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            System.out.println( String.format(&quot;\t Group &#x27;%s already&#x27; exists&quot;,&quot;application_1&quot;));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        System.out.println(&quot;Waiting for new messages&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        while(true) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            List&lt;StreamMessage&lt;String, String&gt;&gt; messages = syncCommands.xreadgroup(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    Consumer.from(&quot;application_1&quot;, &quot;consumer_1&quot;),</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    XReadArgs.StreamOffset.lastConsumed(&quot;weather_sensor:wind&quot;)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            );</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (!messages.isEmpty()) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                for (StreamMessage&lt;String, String&gt; message : messages) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    System.out.println(message);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    // Confirm that the message has been processed using XACK</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    syncCommands.xack(STREAMS_KEY, &quot;application_1&quot;,  message.getId());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This code is a subset of the <code>main()</code> method I have removed the connection management part, to add readability. Let&#x27;s take a look to the code:</p><ul><li>line 3 to 10, using the method <code>xgroupCreate()</code>, that matches the <a href="https://redis.io/commands/xgroup" target="_blank" rel="noopener noreferrer">XGROUP CREATE</a> command,<ul><li>is used to create a new group called <code>application_1</code>,</li><li>consume messages from the stream <code>weather_sensor:wind</code> </li><li>starting at the first message in the stream, this is indicated using the message ID <code>0-0</code>. <em>Note that it is also possible to indicate to the group to start to read at a specific message ID, or only the new messages that arrive after the creating of the consumer group using <code>$</code> special ID (or the helper method <code>XReadArgs.StreamOffset.latest()</code></em>.</li></ul></li><li>line 15 to 30, in this example we use an infinite loop (<code>while(true)</code>) to wait for any new messages published to the streams</li><li>line 17 to 20, the method <code>xreadgroup()</code> returns the messages based on the group configuration<ul><li>line 18 define the consumer named <code>consumer_1</code> that is associated with the group <code>application_1</code>: you can create new group do distribute the read to multiple clients</li><li>line 19 indicates where to start, in this case, <code>StreamOffset.lastConsumed(&quot;weather_sensor:wind&quot;)</code> the consumer will consume messages that have not been read already. With the current configuration of the group (offset <code>0-0</code>), when the consumer will start for the first time, it will read all the existing messages.</li></ul></li><li>line 22 to 28, the application iterates on each messages, and:<ul><li>line 24, process the message, a simple print in this case</li><li>line 26, sends a acknowledgment using <code>xack()</code> command. You have to use the ack command to confirm that a message has been read and processed. The <a href="https://redis.io/commands/xack" target="_blank" rel="noopener noreferrer"><code>XACK</code></a> command removes the message from the pending list of the consumer group.</li></ul></li></ul><p>The complete consumer code is available <a href="https://github.com/tgrall/redis-streams-101-java/blob/master/src/main/java/com/kanibl/redis/streams/simple/RedisStreams101Consumer.java" target="_blank" rel="noopener noreferrer">here</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="build--run-the-simple-java-application"></a>Build &amp; Run the Simple Java Application<a class="hash-link" href="#build--run-the-simple-java-application" title="Direct link to heading">#</a></h3><p>Now that you have a better understanding of the code, let&#x27;s run the producer and consumer. You can run this from your IDE, or using Maven.</p><p>Let&#x27;s do it using Maven CLI, for this open 2 terminals:</p><ul><li>one to produce messages</li><li>one to consume them</li></ul><p><em>1- Clone and Build the project</em></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/tgrall/redis-streams-101-java.git</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin class-name">cd</span><span class="token plain"> redis-streams-101-java</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> mvn clean verify</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><em>2- Post a new message</em></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> mvn exec:java -Dexec.mainClass</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;com.kanibl.redis.streams.simple.RedisStreams101Producer&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><em>3- Consume messages</em></p><p>Open a new terminal and run the following command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> mvn exec:java -Dexec.mainClass</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;com.kanibl.redis.streams.simple.RedisStreams101Consumer&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The consumer will start and consume the message you just posted, and wait for any new messages.</p><p><em>4- In the first terminal post 100 new messages</em></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> mvn exec:java -Dexec.mainClass</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;com.kanibl.redis.streams.simple.RedisStreams101Producer&quot;</span><span class="token plain"> -Dexec.args</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;100&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The consumer will receive and print all the messages.</p><p><em>5- Kill the consumer and post more messages</em></p><p>Let&#x27;s now do another test, stop the consumer using a simple <code>ctrl+C</code>.</p><p>Then post 5 new messages.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> mvn exec:java -Dexec.mainClass</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;com.kanibl.redis.streams.simple.RedisStreams101Producer&quot;</span><span class="token plain"> -Dexec.args</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;5&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The messages are not yet consumed by any application, but still store in Redis Streams.</p><p>So when you start the consumer, it will consumes these new messages.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> mvn exec:java -Dexec.mainClass</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;com.kanibl.redis.streams.simple.RedisStreams101Consumer&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This is a one of the differences between <a href="https://redis.io/topics/streams-intro" target="_blank" rel="noopener noreferrer">Redis Streams</a> and <a href="https://redis.io/topics/pubsub" target="_blank" rel="noopener noreferrer">Redis PubSub</a>. The producer application has publish many messages while the consumer application was not running. Since the consumer is ran with <code>StreamOffset.lastConsumed()</code>, when the consumer is starting, it looks to the last consumed ID, and start to read the streams from there. This method generate a XGROUPREAD command with the group</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="conclusion"></a>Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">#</a></h3><p>In this small project, you have learned, how to use Lettuce, a Java client for Redis to:</p><ul><li>publish messages to a stream</li><li>create a consumer group</li><li>consume messages using the consumer group.</li></ul><p>This is a very basic example, and in a next post I will show you how to work with multiple consumers, and to configure the Consumer Group and Consumers to control which messages you want to read</p><p>More to come!</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_3kfx"><div class="col"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/redis">redis</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/nosql">nosql</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/stream">stream</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/streaming">streaming</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/java">java</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/facebook/docusaurus/edit/master/website/blog/blog/2019-09-02-getting-with-redis-streams-and-java.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2019/09/04/multi-nodes-redis-cluster-with-docker"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« Multi-Nodes Redis Cluster with Docker</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2018/05/23/getting-started-with-mapr-db-json-rest-api"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Getting Started With MapR-DB JSON REST API Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#java--redis-streams" class="table-of-contents__link">Java &amp; Redis Streams</a></li><li><a href="#build--run-the-simple-java-application" class="table-of-contents__link">Build &amp; Run the Simple Java Application</a></li><li><a href="#conclusion" class="table-of-contents__link">Conclusion</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/tgrall" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/tugdualgrall/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.instagram.com/tgrall/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Instagram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/tgrall" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2003 - 2021 Tugdual Grall built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.69db4c69.js"></script>
<script src="/assets/js/main.f5c6966c.js"></script>
</body>
</html>