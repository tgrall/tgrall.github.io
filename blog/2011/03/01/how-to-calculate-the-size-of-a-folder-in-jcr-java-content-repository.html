<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Tug&#39;s Site Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Tug&#39;s Site Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-1520374-2","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">How to calculate the size of a folder in JCR (Java Content Repository)? | Tug&#x27;s Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://tgrall.github.io/blog/2011/03/01/how-to-calculate-the-size-of-a-folder-in-jcr-java-content-repository"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="How to calculate the size of a folder in JCR (Java Content Repository)? | Tug&#x27;s Site"><meta data-react-helmet="true" name="description" content="Today I was working with a partner in Paris and he wanted to know how to calculate the size of a specific folder in the eXo Java Content Repository (JCR)."><meta data-react-helmet="true" property="og:description" content="Today I was working with a partner in Paris and he wanted to know how to calculate the size of a specific folder in the eXo Java Content Repository (JCR)."><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2011-03-01T00:00:00.000Z"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://tgrall.github.io/blog/2011/03/01/how-to-calculate-the-size-of-a-folder-in-jcr-java-content-repository"><link data-react-helmet="true" rel="alternate" href="https://tgrall.github.io/blog/2011/03/01/how-to-calculate-the-size-of-a-folder-in-jcr-java-content-repository" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://tgrall.github.io/blog/2011/03/01/how-to-calculate-the-size-of-a-folder-in-jcr-java-content-repository" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.48522199.css">
<link rel="preload" href="/assets/js/runtime~main.4b9fad76.js" as="script">
<link rel="preload" href="/assets/js/main.ea67b1c9.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Tug&#x27;s Site</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/talks">Talks</a></div><div class="navbar__items navbar__items--right"><a href="https://windr.org" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Windsurfing App<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/tgrall/tgrall.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2022/02/08/getting-started-with-github-releases">Getting Started with GitHub Releases</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2022/01/24/share-private-actions-enterprise">Use Private Actions with your Team</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/11/07/how-to-write-a-github-action-annotation-api">Write GitHub Action: Checks and Annotations API (Part 2)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/10/30/how-to-write-a-github-action">How to Write Custom GitHub Action (Part 1)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/05/16/simple-caching-service-with-redis">Simple caching service with Redis</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_GeHD" itemprop="headline">How to calculate the size of a folder in JCR (Java Content Repository)?</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2011-03-01T00:00:00.000Z" itemprop="datePublished">March 1, 2011</time> Â· 3 min read</div></header><div class="markdown" itemprop="articleBody"><p>Today I was working with a partner in Paris and he wanted to know how to calculate the size of a specific folder in the <a href="http://www.exoplatform.com/company/en/resource-viewer/Features-and-Benefits/eXo-JCR-Features-and-Benefits" target="_blank" rel="noopener noreferrer">eXo Java Content Repository (JCR)</a>.</p><p>For this specific need the goal is to calculate the size of all the documents stored inside a specific location in the content repository. This could be used for example to manage quotas, estimate the size of a shared or personal storage, ... For this specific sample I will only take in consideration the size of the binary part of the document stored in the repository; this means I will not pay attention to the various attributes and meta-data that are also stored, neither the full text index created by <a href="http://lucene.apache.org/" target="_blank" rel="noopener noreferrer">Lucene</a> that is embedded in eXo JCR.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="how-the-files-are-stored-in-the-jcr"></a>How the files are stored in the JCR?<a class="hash-link" href="#how-the-files-are-stored-in-the-jcr" title="Direct link to heading">#</a></h3><p>Files are stored in eXo JCR in the standard node type <code>nt:file</code> (and <code>nt:resource</code>). So for this example I will simply list all the <code>nt:file</code> of a folder and aggregate the size of the file itself. It is important to understand how JCR is storing the binary content. The best way to understand it, is to view it. For that I am using the print information given by  <a href="http://www.exoplatform.com/company/en/resource-viewer/Tutorial/Introduction-to-Crash" target="_blank" rel="noopener noreferrer">CRaSH</a>, a shell for content repository developed by eXo team and lead by <a href="http://julienviet.com/" target="_blank" rel="noopener noreferrer">Julien Viet</a>.</p><p>Here the structure of a PDF document :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">/Documents/jsr170-1.0.pdf</span></span><span class="token-line" style="color:#393A34"><span class="token plain">+-properties</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| +-jcr:primaryType: nt:file</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| +-jcr:mixinTypes: [mix:referenceable,mix:versionable]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| +-jcr:uuid: &#x27;6b89b6f0c0a8006530a8617df51bb0d7&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| +-jcr:created: 2011-02-28T10:11:50.770+01:00</span></span><span class="token-line" style="color:#393A34"><span class="token plain">+-children</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| +-/Groups/spaces/intranet_v2/Documents/Technical/jsr170-1.0.pdf/jcr:content</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As you can see in this node the &#x27;binary&#x27; is not visible, nothing bad here. As written in the specification in the section <code>6.7.22.6 nt:file</code>, the binary content is an attribute of the child node <code>jcr:content</code> that is exposed below:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">/Groups/spaces/intranet_v2/Documents/Technical/jsr170-1.0.pdf/jcr:content</span></span><span class="token-line" style="color:#393A34"><span class="token plain">+-properties</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| +-jcr:primaryType: nt:resource</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| +-jcr:mixinTypes: [exo:owneable,exo:datetime,dc:elementSet]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| +-jcr:uuid: &#x27;6b89b6f7c0a80065735b1a8853d389d0&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| +-jcr:data: &lt;binary&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| +-jcr:encoding: &#x27;UTF-8&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| +-jcr:lastModified: 2011-02-28T10:11:50.767+01:00</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| +-jcr:mimeType: &#x27;application/pdf&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">+-children</span></span><span class="token-line" style="color:#393A34"><span class="token plain">&lt;/binary&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can see now that the <code>jcr:content</code> contains some interesting attributes:</p><ul><li><code>jcr:mimeType</code></li><li><code>jcr:data</code> this is where the binary content, the PDF itself , is.
So using the JCR API you just need to get the content length using the following java code:</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">node.getProperty(&quot;jcr:content/jcr:data&quot;).getLength()</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This returns the number of bits of the binary data.</p><p>So to calculate the size of a folder you just need to navigate in all the documents (nt:file or jcr:content) and cumulate the size of all the files. In this following code, I am calculating the size of the folder &quot;/Documents&quot; by navigating into all the files contains in this folder and subfolders. (I could have chose to query all the <code>jcr:content</code> type instead of <code>nt:file</code>)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Session session = getSession(); // use RepositoryService or context to get a session</span></span><span class="token-line" style="color:#393A34"><span class="token plain">QueryManager manager = session.getWorkspace().getQueryManager();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">String queryStatement = &quot;select * from nt:file where (jcr:path LIKE &#x27;/Documents/%&#x27;)&quot;;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Query query = manager.createQuery(queryStatement, Query.SQL);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">NodeIterator nodeIterator = query.execute().getNodes();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Node node = null;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">long totalSizeInMb = 0;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">while (nodeIterator.hasNext()) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  node = nodeIterator.next();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  totalSizeInMb = totalSizeInMb + node.getProperty(&quot;jcr:content/jcr:data&quot;).getLength() / (1024*1024);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>As you can guess since we are navigating in the hierarchy you have to be very careful when using such query. This example is just a simple code sample to show you some of the cool features provided by the JCR API.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2011/03/16/exo-cloud-ide-develop-for-the-cloud-on-the-cloud"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« eXo Cloud IDE : develop for the Cloud on the Cloud</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2011/01/02/ios-101-how-to-convert-a-string-to-a-nsdate"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">iOS 101: How to convert a String to a NSDate Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#how-the-files-are-stored-in-the-jcr" class="table-of-contents__link">How the files are stored in the JCR?</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/tgrall" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCA1kgHJTFZW-MRcr8KX_QYQ" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/tugdualgrall/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/tgrall" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2003 -- 2022 Tugdual Grall built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.4b9fad76.js"></script>
<script src="/assets/js/main.ea67b1c9.js"></script>
</body>
</html>