<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Tug&#39;s Site Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Tug&#39;s Site Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-1520374-2","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Simple caching service with Redis | Tug&#x27;s Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://tgrall.github.io/blog/2020/05/16/simple-caching-service-with-redis"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Simple caching service with Redis | Tug&#x27;s Site"><meta data-react-helmet="true" name="description" content="One of the most common use cases for Redis is to use it the database as a caching layer for your data, but Redis can do a lot more (I will publish new articles later)!"><meta data-react-helmet="true" property="og:description" content="One of the most common use cases for Redis is to use it the database as a caching layer for your data, but Redis can do a lot more (I will publish new articles later)!"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2020-05-16T00:00:00.000Z"><meta data-react-helmet="true" property="article:tag" content="nosql,redis,microservices"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://tgrall.github.io/blog/2020/05/16/simple-caching-service-with-redis"><link data-react-helmet="true" rel="alternate" href="https://tgrall.github.io/blog/2020/05/16/simple-caching-service-with-redis" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://tgrall.github.io/blog/2020/05/16/simple-caching-service-with-redis" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.acbe81c6.css">
<link rel="preload" href="/assets/js/runtime~main.69db4c69.js" as="script">
<link rel="preload" href="/assets/js/main.f5c6966c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Tug&#x27;s Site</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/talks">Talks</a></div><div class="navbar__items navbar__items--right"><a href="https://windr.org" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Windsurfing App<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/tgrall/tgrall.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/2020/05/16/simple-caching-service-with-redis">Simple caching service with Redis</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/01/02/how-to-use-ssl-slash-tls-with-redis-enterprise">How to use SSL/TLS with Redis Enterprise</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2019/09/19/redis-rolling-upgrade-on-pivotal-cloud-foundry-pcf">Redis Rolling Upgrade on Pivotal Cloud Foundry (PCF)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2019/09/04/multi-nodes-redis-cluster-with-docker">Multi-Nodes Redis Cluster with Docker</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2019/09/02/getting-with-redis-streams-and-java">Getting Started with Redis Streams and Java</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_GeHD" itemprop="headline">Simple caching service with Redis</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2020-05-16T00:00:00.000Z" itemprop="datePublished">May 16, 2020</time> Â· 7 min read</div></header><div class="markdown" itemprop="articleBody"><p><img src="/assets/images/001-ws-caching-17e9d285eeeee51179e053492aa144b9.png"></p><p>One of the most common use cases for Redis is to use it the database as a caching layer for your data, but Redis can do a lot more <em>(I will publish new articles later)</em>!</p><p>In this article, you will learn using a straightforward service, how to cache the result on some REST API calls to accelerate the data access, and also reduce the number of calls to external services.</p><p>For this example, I am using the &quot;Redis Movie Database&quot; application, a microservice-based application that I created to showcase and explain various features of Redis and Redis Enterprise. </p><p>You can see the caching service in action in this video:</p><iframe width="675" height="380" src="https://www.youtube.com/embed/2X6hmXGbLbg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"></iframe><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="architecture-overview"></a>Architecture Overview<a class="hash-link" href="#architecture-overview" title="Direct link to heading">#</a></h3><p>The application uses a third party API provided by the &quot;<a href="http://www.omdbapi.com/" target="_blank" rel="noopener noreferrer">OMDb API</a>&quot; to retrieve the ratings of the movie using its IMDb identifier. The frontend application call the <code>/caching/rating/</code> service to get the rating information from OMDB.</p><p>This service is doing the following:</p><ol><li>Check if the rating data is already cached retrieve from the cache</li><li>If the information is not cached, the system calls the OMDB API with the proper key and Movie ID</li><li>The result is cached in Redis with a time to live of 120 seconds</li><li>The ratings are returned to the client.</li></ol><p><strong>Prerequisites</strong></p><ul><li>Redis 5.x or later.</li><li>Java 8 or later</li><li>Apache Maven 3.6</li><li>Git</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="implementation"></a>Implementation<a class="hash-link" href="#implementation" title="Direct link to heading">#</a></h3><p>In the microservice demonstration project, you can find the caching service in the project below:</p><ul><li><a href="https://github.com/tgrall/redis-microservices-demo/tree/master/caching-service" target="_blank" rel="noopener noreferrer">Caching Service</a></li></ul><p>The Spring Boot application exposes a REST endpoint <a href="https://github.com/tgrall/redis-microservices-demo/blob/master/caching-service/src/main/java/io/redis/demos/services/caching/RestStatusController.java" target="_blank" rel="noopener noreferrer">RestStatusController.java</a> with the following key features:</p><ul><li><code>/api/1.0/caching/configuration/omdb_api</code> : to save the OMDb API key in Redis.</li><li><code>/api/1.0/caching/ratings/{id}</code> : to retrieve the IMDB Rating information.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="data-structure"></a>Data Structure<a class="hash-link" href="#data-structure" title="Direct link to heading">#</a></h4><p>The Caching Service is pretty simple and using two sets of keys:</p><ul><li><code>ms:config</code>: is a Redis Hash that will be used to store all global configuration; for the caching service, the entry <code>OMDB_API_KEY</code> will contain the OMDb API key.</li><li><code>ms:cache:ws:*</code> : one entry for each movie viewed by a user, where the IMDb movie id replaces the <code>*</code>. The hash contains the ratings, and each of the Movie Rating sites is a key in the hash (&quot;Internet Movie Database&quot;,  &quot;Rotten Tomatoes&quot;, &quot;Metacritic&quot;), and the value is the rating itself.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="code"></a>Code<a class="hash-link" href="#code" title="Direct link to heading">#</a></h4><p>The implementation of the caching layer is simple and located in the class below:</p><ul><li><a href="https://github.com/tgrall/redis-microservices-demo/blob/master/caching-service/src/main/java/io/redis/demos/services/caching/service/WebServiceCachingService.java" target="_blank" rel="noopener noreferrer"><code>WebServiceCachingService</code></a></li></ul><p><strong>Getting the Redis Connection</strong></p><p>In this project, I have not used Redis/Spring integration <em>by choice</em>, I am only using Spring injection and Spring Boot Web features.</p><ul><li>the <code>afterConstruct()</code> method creates the JedisPool from the Spring Configuration</li><li>then each time a connection is needed, the application calls <code>Jedis jedis = jedisPool.getResource()</code> to get a connection from the pool.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="setting--getting-the-omdb-api-key"></a>Setting &amp; Getting the OMDb API Key<a class="hash-link" href="#setting--getting-the-omdb-api-key" title="Direct link to heading">#</a></h4><p>As you have seen earlier, the OMDb API Key is stored in a hash associated with the Redis key <code>ms:config</code>.</p><ul><li>The method <code>saveOMDBAPIKey</code> is used to store the configuring with a  <code>hset</code> call.</li></ul><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    jedis = jedisPool.getResource();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    jedis.hset(KEY_CONFIG, OMDB_API_KEY, key);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    omdbAPIKEY = key;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ul><li>line 1: get the connection from the pool</li><li>line 2: set the key in the hash *(as you can see the application uses static variables (<code>KEY_CONFIG</code> and <code>OMDB_API_KEY</code>)</li><li>line 3: the key received as a method parameter is set to a class member <code>omdbAPIKEY</code> to avoid calling the hash each time.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="calling-omdb-api-and-caching-or-not-the-result"></a>Calling OMDb API and Caching (or not) the result<a class="hash-link" href="#calling-omdb-api-and-caching-or-not-the-result" title="Direct link to heading">#</a></h4><p>The method <code>getRatings</code> receives two parameters:</p><ul><li><code>imdbId</code> the IMDb id</li><li><code>withCache</code> a boolean value to use or not Redis. The goal here is to show as a demonstration of the benefits of using Redis.</li></ul><p>Let&#x27;s now look at the code:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly java"><pre tabindex="0" class="prism-code language-java codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> String restCallKey = KEY_PREFIX + imdbId;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        try (Jedis jedis = jedisPool.getResource()) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Look in the map to see if the value has been cached</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (withCache) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                returnValue = jedis.hgetAll(restCallKey);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            if (returnValue.isEmpty()) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                returnValue.put(&quot;imdb_id&quot;, imdbId);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                CloseableHttpClient httpClient = HttpClientBuilder.create().build();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                HttpGet getRequest = new HttpGet(url);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                getRequest.addHeader(&quot;accept&quot;, &quot;application/json&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                ResponseHandler&lt;String&gt; responseHandler = new BasicResponseHandler();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                String WsCall = httpClient.execute(getRequest, responseHandler);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                Map&lt;String, Object&gt; map = jsonMapper.readValue(WsCall, Map.class);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                List&lt;Map&lt;String, String&gt;&gt; ratings = (List&lt;Map&lt;String, String&gt;&gt;) map.get(&quot;Ratings&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                Map&lt;String, String&gt; ratingAsMap = new HashMap&lt;&gt;();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                for (Map&lt;String, String&gt; it : ratings) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                    ratingAsMap.put(it.get(&quot;Source&quot;), it.get(&quot;Value&quot;));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                returnValue.putAll(ratingAsMap);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                jedis.hset(restCallKey, returnValue);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                jedis.expire(restCallKey, TTL);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch(HttpResponseException e){</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Small hack to keep it simple</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            returnValue.put(&quot;Metacritic&quot;, &quot;&lt;p style=&#x27;color:red&#x27;&gt;Error: OMDBAPI Key is invalid -- see services page&lt;/p&gt;&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            omdbAPIKEY = null;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        } catch (IOException e) {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            e.printStackTrace();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    } else {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // Small hack to keep it simple</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        returnValue.put(&quot;Metacritic&quot;, &quot;&lt;p style=&#x27;color:red&#x27;&gt;Error: OMDBAPI Key is not set, please configure it -- see services page&lt;/p&gt;&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    long end = System.currentTimeMillis();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    returnValue.put(&quot;elapsedTimeMs&quot;, Long.toString(end - start) );</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    return returnValue;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>So if you look in the code carefully you see that only a few lines are related to the cache itself:</p><ul><li>Line 1, the key is created from a prefix and the IMDb identifier.</li><li>Line 3, the application retrieves a connection from the Jedis Pool.</li><li>Line 7, if the cache is enabled,  the connection to get the value from Redis <code>returnValue = jedis.hgetAll(restCallKey)</code></li><li>If a value is present in the cache, the value is returned to the caller</li><li>If <code>returnValue</code> is empty,  the OMDB REST service must be called (lines 11 to 25)</li><li>The result of the Web service call is stored in the <code>returnValue</code> variable, and save into Redis with a time to live (TTL) of 120 seconds (Line 27 to 29)</li><li>Finally, the value is returned to the caller (Line 47).</li></ul><p>Quite simple, no?</p><p>It is possible to optimize a little bit the application/code with few additions:</p><ul><li>Make the TTL configurable by adding a new entry in the <code>ms:config</code> cache</li><li>Use <a href="https://redis.io/topics/pipelining" target="_blank" rel="noopener noreferrer">pipelining</a> to reduce the round trip time (RTT)</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="running-the-application"></a>Running the application<a class="hash-link" href="#running-the-application" title="Direct link to heading">#</a></h3><p>In the project, the service connects to a <code>local</code> instance of Redis on port <code>6379</code>. If you want to use a different instance or configure a password/user, you have to edit the <code>/redis-microservices-demo/caching-service/application.properties</code>.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="cloning-and-building"></a>Cloning and Building<a class="hash-link" href="#cloning-and-building" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/tgrall/redis-microservices-demo.git</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token builtin class-name">cd</span><span class="token plain"> redis-microservices-demo/caching-service</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> mvn clean package</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="running-the-application-1"></a>Running the application<a class="hash-link" href="#running-the-application-1" title="Direct link to heading">#</a></h4><p>The application is a Spring Boot application, run the following command to start it:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> mvn spring-boot:run</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then you should save your <a href="https://www.patreon.com/join/omdb" target="_blank" rel="noopener noreferrer">OMDB API key</a> in Redis using the following call:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -X POST http://localhost:8084/api/1.0/caching/configuration/omdb_api</span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain">?key</span><span class="token punctuation" style="color:#393A34">\</span><span class="token operator" style="color:#393A34">=</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">YOUR_KEY</span><span class="token punctuation" style="color:#393A34">]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Now you can call the service itself to retrieve the ratings of the movie &quot;WarGames&quot;</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -X GET http://localhost:8084/api/1.0/caching/ratings/tt0086567</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Call it multiple times, and you will see that the first call is *slow&quot; (100ms or more). Then subsequent requests will be a lot faster, as the data are coming out of Redis. After tow minutes, the data is removed from the cache automatically (expiration), and the OMDB service will be called again.</p><p>You can also force the service to no use the cache using the following call:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -X GET http://localhost:8084/api/1.0/caching/ratings/tt0086567?cache</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="conclusion"></a>Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">#</a></h3><p>The pattern used here is called &quot;Cache-Aside&quot;; and usually pretty easy to implement. It is interesting to notice that many libraries such as Spring provide built-in features to implement such caches.</p><p>That said, this is not a silver bullet, you still have to look at the following points when you are implementing such caching service:</p><ul><li>Loading the cache: in the example, the cache is populated when the service is called. This lazy loading approach is excellent since the cache is only filled with data that are used by the application. However, the first call is paying the price of higher latency, so on your application, you may require to load the data at startup to avoid any hit miss.</li><li>Cache Invalidation and Lifetime: When caching data, it is essential to look at the invalidation strategy, when and how I can update the data in the cache, but also how long the data will stay in the cache. In the example above, each data will remain for two minutes. </li></ul><p>So now you are all set to implement a simple cache and have consistent fast access to your application data, independently of the backend.</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_3kfx"><div class="col"><b>Tags:</b><ul class="tags_2ga9 padding--none margin-left--sm"><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/nosql">nosql</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/redis">redis</a></li><li class="tag_11ep"><a class="tag_1Okp tagRegular_3MiF" href="/blog/tags/microservices">microservices</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/facebook/docusaurus/edit/master/website/blog/blog/2020-05-16-simple-caching-service-with-redis.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2020/01/02/how-to-use-ssl-slash-tls-with-redis-enterprise"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">How to use SSL/TLS with Redis Enterprise Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#architecture-overview" class="table-of-contents__link">Architecture Overview</a></li><li><a href="#implementation" class="table-of-contents__link">Implementation</a></li><li><a href="#running-the-application" class="table-of-contents__link">Running the application</a></li><li><a href="#conclusion" class="table-of-contents__link">Conclusion</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/tgrall" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/tugdualgrall/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.instagram.com/tgrall/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Instagram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/tgrall" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2003 - 2021 Tugdual Grall built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.69db4c69.js"></script>
<script src="/assets/js/main.f5c6966c.js"></script>
</body>
</html>