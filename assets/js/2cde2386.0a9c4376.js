(self.webpackChunktgrall_blog=self.webpackChunktgrall_blog||[]).push([[46348],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return u},kt:function(){return m}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},l=Object.keys(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(a=0;a<l.length;a++)n=l[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),s=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=s(e.components);return a.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,p=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),d=s(n),m=r,h=d["".concat(p,".").concat(m)]||d[m]||c[m]||l;return n?a.createElement(h,i(i({ref:t},u),{},{components:n})):a.createElement(h,i({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,i=new Array(l);i[0]=d;var o={};for(var p in t)hasOwnProperty.call(t,p)&&(o[p]=t[p]);o.originalType=e,o.mdxType="string"==typeof e?e:r,i[1]=o;for(var s=2;s<l;s++)i[s]=n[s];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},57367:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return o},contentTitle:function(){return p},metadata:function(){return s},assets:function(){return u},toc:function(){return c},default:function(){return m}});var a=n(22122),r=n(19756),l=(n(67294),n(3905)),i=["components"],o={title:"Getting started with MapR-DB Table Replication",categories:"nosql maprdb mapr replication"},p=void 0,s={permalink:"/blog/2017/08/08/getting-started-with-mapr-db-table-replication",editUrl:"https://github.com/facebook/docusaurus/edit/master/website/blog/blog/2017-08-08-getting-started-with-mapr-db-table-replication.md",source:"@site/blog/2017-08-08-getting-started-with-mapr-db-table-replication.md",title:"Getting started with MapR-DB Table Replication",description:"Introduction",date:"2017-08-08T00:00:00.000Z",formattedDate:"August 8, 2017",tags:[],readingTime:5.19,truncated:!0,authors:[],prevItem:{title:"Getting Started With MapR-DB JSON REST API",permalink:"/blog/2018/05/23/getting-started-with-mapr-db-json-rest-api"},nextItem:{title:"Getting Started with Kafka REST Proxy for MapR Streams",permalink:"/blog/2017/01/20/getting-started-with-kafka-rest-proxy-for-mapr-streams"}},u={authorsImageUrls:[]},c=[{value:"Introduction",id:"introduction",children:[{value:"Prerequisites",id:"prerequisites",children:[]}]},{value:"Setting Up Replication",id:"setting-up-replication",children:[{value:"Configuring the clusters",id:"configuring-the-clusters",children:[]},{value:"Installing and Configuring the MapR Gateway",id:"installing-and-configuring-the-mapr-gateway",children:[]},{value:"Creating Table with Replication",id:"creating-table-with-replication",children:[]}]},{value:"Conclusion",id:"conclusion",children:[]}],d={toc:c};function m(e){var t=e.components,n=(0,r.Z)(e,i);return(0,l.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,l.kt)("h2",{id:"introduction"},"Introduction"),(0,l.kt)("p",null,"MapR-DB Table Replication allows data to be replicated to another table that could be on on the same cluster or in another cluster. This is different from the automatic and intra-cluster replication that copies the data into different physical nodes for high availability and prevent data loss."),(0,l.kt)("p",null,"This tutorial focuses on the MapR-DB Table Replication that replicates data between tables on different clusters."),(0,l.kt)("p",null,"Replicating data between different clusters allows you to:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"provide another level of disaster recovery that protects your data and applications against global data center failure,"),(0,l.kt)("li",{parentName:"ul"},"push data close to the applications and users, "),(0,l.kt)("li",{parentName:"ul"},"aggregate the data from mutliple datacenters.")),(0,l.kt)("p",null,(0,l.kt)("strong",{parentName:"p"},"Replication Topologies")),(0,l.kt)("p",null,"MapR-DB Table Replication provides various topologies to adapt the replication to the business and technical requirements:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("em",{parentName:"li"},"Master-slave replication")," : in this topology, you replicate one way from source tables to replicas. The replicas can be in a remote cluster or in the cluster where the source tables are located."),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("em",{parentName:"li"},"Multi-Master replication")," : in this replication topology, there are two master-slave relationships, with each table playing both the role of a master and a slave. Client applications update both tables and each table replicates updates to the other.")),(0,l.kt)("p",null,"In this example you will learn how to setup multi-master replication."),(0,l.kt)("h3",{id:"prerequisites"},"Prerequisites"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"2 MapR Clusters 5.x with Enterprise Edition license",(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},"in this demonstration they are called ",(0,l.kt)("inlineCode",{parentName:"li"},"cluster1")," and ",(0,l.kt)("inlineCode",{parentName:"li"},"cluster2"))))),(0,l.kt)("h2",{id:"setting-up-replication"},"Setting Up Replication"),(0,l.kt)("p",null,"In the next steps you will configure your clusters to enable mutip-master replication as follow:"),(0,l.kt)("p",null,(0,l.kt)("img",{parentName:"p",src:"http://tgrall.github.io/images/posts/maprdb-replication/replication.png",alt:"Architecture"})),(0,l.kt)("h3",{id:"configuring-the-clusters"},"Configuring the clusters"),(0,l.kt)("p",null,"Each node of the source cluster must communicate with the destination cluster's CLDB nodes. On each node of your source cluster edit the ",(0,l.kt)("inlineCode",{parentName:"p"},"mapr-clusters.conf")," file and add the destination cluster information."),(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"Cluster 1 Configuration")),(0,l.kt)("p",null,"In all the nodes of ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster1"),", edit the  ",(0,l.kt)("inlineCode",{parentName:"p"},"/opt/mapr/conf/mapr-clusters.conf")," file and add the ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster2")," configuration. The file should look like the following:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"cluster1 secure=false cluster1-node1:7222 cluster1-node2:7222 cluster1-node2:7222\n\ncluster2 secure=false cluster2-node1:7222 cluster2-node2:7222 cluster2-node3:7222\n")),(0,l.kt)("p",null,(0,l.kt)("em",{parentName:"p"},"Cluster 2 Configuration")),(0,l.kt)("p",null,"In all the nodes of ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster2"),", edit the  ",(0,l.kt)("inlineCode",{parentName:"p"},"/opt/mapr/conf/mapr-clusters.conf")," file and add the ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster1")," configuration. The file should look like the following:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"cluster2 secure=false cluster2-node1:7222 cluster2-node2:7222 cluster2-node3:7222\n\ncluster1 secure=false cluster1-node1:7222 cluster1-node2:7222 cluster1-node2:7222\n")),(0,l.kt)("p",null,"You can find information about the ",(0,l.kt)("inlineCode",{parentName:"p"},"mapr-clusters.conf")," format in ",(0,l.kt)("a",{parentName:"p",href:"http://maprdocs.mapr.com/home/ReferenceGuide/mapr-clusters.conf.html"},"the documentation"),"."),(0,l.kt)("p",null,"Open a terminal window on one of the ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster1")," node using ",(0,l.kt)("inlineCode",{parentName:"p"},"mapr")," user, and do the following:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ ls /mapr/cluster1/\napps   hbase  installer  opt  tmp  user  var\n\n$ ls /mapr/cluster2/\napps   hbase  installer  opt  tmp  user  var\n\n")),(0,l.kt)("h3",{id:"installing-and-configuring-the-mapr-gateway"},"Installing and Configuring the MapR Gateway"),(0,l.kt)("p",null,"A MapR gateway mediates one-way communication between a source MapR cluster and a destination MapR cluster. In this example you will use mult-master replication, this means that data will be replicated from ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster1")," to ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster2")," and from ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster2")," to ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster1"),"."),(0,l.kt)("p",null,"The good practice is to install the MapR-Gateway to the destination cluster, so in our case let's install one gateway on one of the ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster1")," node, and one gateway on one of the ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster2")," node. Note that this configuration will not be highly available, and usually you will deploy more than 1 gateway by cluster."),(0,l.kt)("h4",{id:"installing-the-mapr-gateway"},"Installing the MapR-Gateway"),(0,l.kt)("p",null,"As root on one node of the ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster1"),", adapt the command to your linux environment, for example on the node ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster1-node2")),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ yum install mapr-gateway\n\n\n# Update MapR configuration\n$ /opt/mapr/server/configure.sh -N cluster1 -C cluster1-node1:7222,cluster1-node2:7222,cluster1-node3:7222 -R\n\n")),(0,l.kt)("p",null,"Do the same on ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster2"),", for example on the node ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster2-node2"),":"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ yum install mapr-gateway\n\n\n# Update MapR configuration\n$ /opt/mapr/server/configure.sh -N cluster1 -C cluster2-node1:7222,cluster2-node2:7222,cluster2-node3:7222 -R\n\n")),(0,l.kt)("h4",{id:"registering-the-gateway-to-the-clusters"},"Registering the Gateway to the Clusters"),(0,l.kt)("p",null,"Now that we have a gateway running on each cluster, you have to ",(0,l.kt)("strong",{parentName:"p"},(0,l.kt)("em",{parentName:"strong"},"register the gateway"))," in each cluster."),(0,l.kt)("p",null,"On ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster1")," run the following command to register the ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster2")," gateway as destination:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ maprcli cluster gateway set -dstcluster cluster2 -gateways cluster2-node2\n\n# Check the configuration\n$ maprcli cluster gateway list\n")),(0,l.kt)("p",null,"On ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster2")," run the following command to register the ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster1")," gateway as destination:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ maprcli cluster gateway set -dstcluster cluster1 -gateways cluster1-node2\n\n# Check the configuration\n$ maprcli cluster gateway list\n")),(0,l.kt)("h3",{id:"creating-table-with-replication"},"Creating Table with Replication"),(0,l.kt)("p",null,"In a terminal window, as ",(0,l.kt)("inlineCode",{parentName:"p"},"mapr")," user on ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster1"),", create a table and insert documents:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ maprcli table create -path /apps/user_profiles  -tabletype json\n\n")),(0,l.kt)("p",null,"This create a new JSON table; it is also possible to use ",(0,l.kt)("inlineCode",{parentName:"p"},"/mapr/cluster1/apps/user_profiles"),"."),(0,l.kt)("p",null,"Let's now add documents using MapR-DB Shell:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'$ mapr dbshell\n\nmaprdb mapr:> insert /apps/user_profiles --value \'{"_id":"user001" , "first_name":"John", "last_name":"Doe"}\'\n\nmaprdb mapr:> find /apps/user_profiles\n\n')),(0,l.kt)("h4",{id:"adding-table-replication"},"Adding Table Replication"),(0,l.kt)("p",null,"Let's now enable replication between ",(0,l.kt)("inlineCode",{parentName:"p"},"user_profiles")," on ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster1")," to a ",(0,l.kt)("inlineCode",{parentName:"p"},"user_profiles")," table in ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster2"),"."),(0,l.kt)("p",null,"In ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster1"),", on a terminal window as ",(0,l.kt)("inlineCode",{parentName:"p"},"mapr")," run the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ maprcli table replica autosetup -path /apps/user_profiles -replica /mapr/cluster2/apps/user_profiles -multimaster yes\n")),(0,l.kt)("p",null,"You can get information about the replication configuration for the table using the following command:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},"$ maprcli table replica list -path /apps/user_profiles -json\n")),(0,l.kt)("h4",{id:"testing-replication"},"Testing Replication"),(0,l.kt)("p",null,"Open another terminal in ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster2")," and use MapR-DB Shell to look at the replicated data:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'$ mapr dbshell\n\nmaprdb mapr:> find /apps/user_profiles\n{"_id":"user001","first_name":"John","last_name":"Doe"}\n1 document(s) found.\n\n')),(0,l.kt)("p",null,"You can also use the full path ",(0,l.kt)("inlineCode",{parentName:"p"},"/mapr/cluster2/apps/user_profiles")),(0,l.kt)("p",null,"In ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster1")," add a new document using MapR-DB Shell:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre"},'$ mapr dbshell\n\nmaprdb mapr:> insert /apps/user_profiles --value \'{"_id":"user002" , "first_name":"Simon", "last_name":"Dupont"}\'\n\nmaprdb mapr:> find /apps/user_profiles\n')),(0,l.kt)("p",null,"Do a find in ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster2")," table, and you will see that the data have been replicated."),(0,l.kt)("p",null,"You can insert or delete a document in ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster2")," and do a find in ",(0,l.kt)("inlineCode",{parentName:"p"},"cluster1"),", you will see that the new document is also replicated in the other direction."),(0,l.kt)("p",null,"Note, for this demonstration, we use 2 terminals connected to each cluster you can do some test using the Global Namespace in a single MapR-DB Shell. "),(0,l.kt)("h2",{id:"conclusion"},"Conclusion"),(0,l.kt)("p",null,"In this tutorial you have learned how to setup the MapR-DB Multi-Master replication to have data automatically replicated between 2 clusters."),(0,l.kt)("p",null,"MapR-DB Table Replication provides many options, not only in term of topology (master-slave/mult-master), but also some options and commands to:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},"replicate some columns/attributes or column family"),(0,l.kt)("li",{parentName:"ul"},"configure replication in a secured cluster"),(0,l.kt)("li",{parentName:"ul"},"pause replication.")),(0,l.kt)("p",null,"You can find more information about the MapR-DB Table Replication, and MapR-Gateway in the documentation:"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"http://maprdocs.mapr.com/home/MapR-DB/ReplicatingMapR-DBTables.html"},"Table Replication")," "),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"http://maprdocs.mapr.com/home/MapR-DB/ConfiguringMapRClustersForTR.html"},"Setting up Table Replication")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"http://maprdocs.mapr.com/home/Gateways/MapRGateways.html"},"Configuring and Managing MapR Gateways"))))}m.isMDXComponent=!0}}]);