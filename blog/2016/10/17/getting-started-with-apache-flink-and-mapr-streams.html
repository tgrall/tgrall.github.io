<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Tug&#39;s Site Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Tug&#39;s Site Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-1520374-2","auto"),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Getting started with Apache Flink and Mapr Streams | Tug&#x27;s Site</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://tgrall.github.io/blog/2016/10/17/getting-started-with-apache-flink-and-mapr-streams"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="Getting started with Apache Flink and Mapr Streams | Tug&#x27;s Site"><meta data-react-helmet="true" name="description" content="Introduction"><meta data-react-helmet="true" property="og:description" content="Introduction"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2016-10-17T00:00:00.000Z"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://tgrall.github.io/blog/2016/10/17/getting-started-with-apache-flink-and-mapr-streams"><link data-react-helmet="true" rel="alternate" href="https://tgrall.github.io/blog/2016/10/17/getting-started-with-apache-flink-and-mapr-streams" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://tgrall.github.io/blog/2016/10/17/getting-started-with-apache-flink-and-mapr-streams" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.acbe81c6.css">
<link rel="preload" href="/assets/js/runtime~main.e6fab63a.js" as="script">
<link rel="preload" href="/assets/js/main.f5c6966c.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Tug&#x27;s Site</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/talks">Talks</a></div><div class="navbar__items navbar__items--right"><a href="https://windr.org" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Windsurfing App<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://github.com/tgrall/tgrall.github.io" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/05/16/simple-caching-service-with-redis">Simple caching service with Redis</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/01/02/how-to-use-ssl-slash-tls-with-redis-enterprise">How to use SSL/TLS with Redis Enterprise</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2019/09/19/redis-rolling-upgrade-on-pivotal-cloud-foundry-pcf">Redis Rolling Upgrade on Pivotal Cloud Foundry (PCF)</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2019/09/04/multi-nodes-redis-cluster-with-docker">Multi-Nodes Redis Cluster with Docker</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2019/09/02/getting-with-redis-streams-and-java">Getting Started with Redis Streams and Java</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_GeHD" itemprop="headline">Getting started with Apache Flink and Mapr Streams</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2016-10-17T00:00:00.000Z" itemprop="datePublished">October 17, 2016</time> Â· 7 min read</div></header><div class="markdown" itemprop="articleBody"><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="introduction"></a>Introduction<a class="hash-link" href="#introduction" title="Direct link to heading">#</a></h2><p><a href="https://flink.apache.org/" target="_blank" rel="noopener noreferrer">Apache Flink</a> is an open source platform for distributed stream and batch data processing. Flink is a streaming data flow engine with several APIs to create data streams oriented application.</p><p>It is very common for Flink applications to use <a href="http://kafka.apache.org/" target="_blank" rel="noopener noreferrer">Apache Kafka</a> for data input and output.</p><p>This article will guide you into  the steps to use Apache Flink with <a href="https://www.mapr.com/products/mapr-streams" target="_blank" rel="noopener noreferrer">MapR Streams</a>. MapR Streams is a distributed messaging system for streaming event data at scale, and itâ€™s integrated into the <a href="https://www.mapr.com/products/mapr-converged-data-platform" target="_blank" rel="noopener noreferrer">MapR Converged Data Platform</a>, based on the Apache Kafka API (0.9.0),
this article use the same code and approach than the <a href="http://tgrall.github.io/blog/2016/10/12/getting-started-with-apache-flink-and-kafka/" target="_blank" rel="noopener noreferrer">Flink and Kafka Getting Started</a>.</p><p><img src="http://tgrall.github.io/images/posts/flink-kafka/flink-mapr-streams.png" alt="MapR Streams and Flink">.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h3><ul><li>MapR 5.2<ul><li>You can use <a href="https://www.mapr.com/products/mapr-sandbox-hadoop" target="_blank" rel="noopener noreferrer">MapR Converged Data Platform Sandbox</a></li></ul></li><li>MapR Client installed on your development host<ul><li><a href="http://maprdocs.mapr.com/home/AdvancedInstallation/SettingUptheClient-install-mapr-client.html" target="_blank" rel="noopener noreferrer">Installation and Configuration steps</a></li></ul></li><li>Git</li><li>Maven 3.x or later</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="create-your-flink-streaming-project"></a>Create your Flink Streaming Project<a class="hash-link" href="#create-your-flink-streaming-project" title="Direct link to heading">#</a></h2><p>The first step is to create an Java application, the easiest is to use the flink-quickstart-java archetype, that contains the core dependencies and packaging tasks. This article is similar with the <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.1/quickstart/run_example_quickstart.html" target="_blank" rel="noopener noreferrer">Apache Flink Quick Start Example</a>, with a clear focus on data input and output with MapR Streams. </p><p>In this application we will create two jobs:</p><ul><li><code>WriteToKafka</code> : that generates random string and post them to a MapR Streams Topic using the Kafka Flink Connector and its Producer API.</li><li><code>ReadFromKafka</code> : that reads the same topic and print the messages in the standard output using the Kafka Flink Connector and its Consumer. API.</li></ul><p>The full project is available on GitHub:</p><ul><li><a href="https://github.com/mapr-demos/mapr-streams-flink-demo" target="_blank" rel="noopener noreferrer">MapR Streams Flink Demo</a></li></ul><p>Letâ€™s create the project using Apache Maven:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">mvn archetype:generate \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      -DarchetypeGroupId=org.apache.flink\</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      -DarchetypeArtifactId=flink-quickstart-java \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      -DarchetypeVersion=1.1.2 \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      -DgroupId=com.mapr.demos \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      -DartifactId=mapr-streams-flink-demo \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      -Dversion=1.0-SNAPSHOT \</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      -DinteractiveMode=false </span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Maven will create the following structure:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ tree mapr-streams-flink-demo/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">mapr-streams-flink-demo/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">â”œâ”€â”€ pom.xml</span></span><span class="token-line" style="color:#393A34"><span class="token plain">â””â”€â”€ src</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    â””â”€â”€ main</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        â”œâ”€â”€ java</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        â”‚   â””â”€â”€ com</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        â”‚       â””â”€â”€ mapr</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        â”‚           â””â”€â”€ demos</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        â”‚               â”œâ”€â”€ BatchJob.java</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        â”‚               â”œâ”€â”€ SocketTextStreamWordCount.java</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        â”‚               â”œâ”€â”€ StreamingJob.java</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        â”‚               â””â”€â”€ WordCount.java</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        â””â”€â”€ resources</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            â””â”€â”€ log4j.properties</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This project is configured to create a Jar file that contains your flink project code and also includes all dependencies needed to run it.</p><p>The project contains some other sample jobs, we do not need them for this article, you can either keep them to educational purposes or simply remove them from the project.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="add-kafka--mapr-streams-dependencies"></a>Add Kafka &amp; MapR Streams Dependencies<a class="hash-link" href="#add-kafka--mapr-streams-dependencies" title="Direct link to heading">#</a></h2><p>Open the <code>pom.xml</code> and add the following dependencies to your project:</p><p><strong>1- Add MapR Maven Repository</strong></p><p>In the <code>&lt;repositories&gt;</code> element add :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">   &lt;repository&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">     &lt;id&gt;mapr-releases&lt;/id&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">     &lt;url&gt;http://repository.mapr.com/maven/&lt;/url&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">     &lt;snapshots&gt;&lt;enabled&gt;false&lt;/enabled&gt;&lt;/snapshots&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">     &lt;releases&gt;&lt;enabled&gt;true&lt;/enabled&gt;&lt;/releases&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   &lt;/repository&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>2- Add MapR Streams libraries</strong></p><p>In the <code>&lt;dependencies&gt;</code> element:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;dependency&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   &lt;groupId&gt;com.mapr.streams&lt;/groupId&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   &lt;artifactId&gt;mapr-streams&lt;/artifactId&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   &lt;version&gt;5.2.0-mapr&lt;/version&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;/dependency&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;dependency&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   &lt;artifactId&gt;kafka-clients&lt;/artifactId&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">   &lt;version&gt;0.9.0.0-mapr-1602&lt;/version&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;/dependency&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>3- Add Flink Kafka Connector libraries</strong></p><p>As a first step, we have to add the Flink Kafka connector as a dependency so that we can use the Kafka sink. Add this to the pom.xml file in the dependencies section:</p><p>You must add now the Flink Kafka Connector dependency to use the Kafka sink. Add the following entry in the <code>&lt;dependencies&gt;</code> element:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;dependency&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;artifactId&gt;flink-connector-kafka-0.9_2.10&lt;/artifactId&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;version&gt;${flink.version}&lt;/version&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain"> &lt;/dependency&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>4- Exclude Kafka Client to allow use of MapR Streams Client</strong></p><p>As you may know, MapR Streams uses the Kafka 0.9.0 API to produce and consume messages. So we need now to remove (exclude) tha Apache Kafka Client API to be sure that Flink use MapR Streams.</p><p>In the Flink Kafka Connector dependency add the following exclusion:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;dependency&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;groupId&gt;org.apache.flink&lt;/groupId&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;artifactId&gt;flink-connector-kafka-0.9_2.10&lt;/artifactId&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    &lt;version&gt;${flink.version}&lt;/version&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;exclusions&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;exclusion&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          &lt;artifactId&gt;kafka-clients&lt;/artifactId&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/exclusion&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;exclusion&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          &lt;groupId&gt;org.apache.kafka&lt;/groupId&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          &lt;artifactId&gt;kafka_2.10&lt;/artifactId&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &lt;/exclusion&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      &lt;/exclusions&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &lt;/dependency&gt;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The Flink project is now ready to use the DataStream using the Kafka Connector so you can send and receive messages from MapR Streams.</p><p>Letâ€™s now create a Stream in MapR and write some simple Flink code to use it.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="create-the-mapr-streams-and-topic"></a>Create the MapR Streams and Topic<a class="hash-link" href="#create-the-mapr-streams-and-topic" title="Direct link to heading">#</a></h2><p>A stream is a collection of topics that you can manage as a group by:</p><ol><li>Setting security policies that apply to all topics in that stream</li><li>Setting a default number of partitions for each new topic that is created in the stream</li><li>Set a time-to-live for messages in every topic in the stream</li></ol><p>You can find more information about MapR Streams concepts in the <a href="http://maprdocs.mapr.com/51/MapR_Streams/concepts.html" target="_blank" rel="noopener noreferrer">documentation</a>.</p><p>On your Mapr Cluster or Sandbox run the following commands: </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ maprcli stream create -path /apps/application-stream -produceperm p -consumeperm p -topicperm p</span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ maprcli stream topic create -path /apps/application-stream -topic flink-demo </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="install-and-use-mapr-kafka-utilities"></a>Install and use MapR Kafka utilities<a class="hash-link" href="#install-and-use-mapr-kafka-utilities" title="Direct link to heading">#</a></h3><p>Install <code>the mapr-kafka</code> package on your cluster :</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">yum install mapr-kafka</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Open two terminal windows and run the producer and consumer kafka utilities using the following commands:</p><p>Producer</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">/opt/mapr/kafka/kafka-0.9.0/bin/kafka-console-producer.sh --broker-list this.will.be.ignored:9092 --topic /apps/application-stream:flink-demo</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Consumer</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">/opt/mapr/kafka/kafka-0.9.0/bin/kafka-console-consumer.sh --new-consumer --bootstrap-server this.will.be.ignored:9092 --topic /apps/application-stream:flink-demo</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the producer window, you can post some messages and see them in the consumer windows. We will use these tools to follow the interactions between MapR Streams and Flink.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="write-your-flink-application"></a>Write your Flink application<a class="hash-link" href="#write-your-flink-application" title="Direct link to heading">#</a></h2><p>Letâ€™s now use the Flink Kafka Connector to send messages to MapR Streams and consume them.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="producer"></a>Producer<a class="hash-link" href="#producer" title="Direct link to heading">#</a></h3><p>The producer generates messages using the <code>SimpleStringGenerator()</code> class and send the string to the <code>/apps/application-stream:flink-demo</code> topic.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  public static void main(String[] args) throws Exception {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties properties = new Properties();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // properties.setProperty(&quot;bootstrap.servers&quot;, &quot;&lt;kafka-broker&gt;:9092&quot;); // not used by MapR Streams</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    properties.setProperty(&quot;streams.buffer.max.time.ms&quot;, &quot;200&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    DataStream&lt;String&gt; stream = env.addSource(new SimpleStringGenerator());</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    stream.addSink(new FlinkKafkaProducer09&lt;&gt;(&quot;/apps/application-stream:flink-demo&quot;, new SimpleStringSchema(), properties));</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    env.execute();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The <code>SimpleStringGenerator()</code> method code is available <a href="https://github.com/mapr-demos/mapr-streams-flink-demo/blob/master/src/main/java/com/mapr/demos/WriteToKafka.java#L46-L61" target="_blank" rel="noopener noreferrer">here</a>.</p><p>The main steps are:</p><ul><li>create a new <code>StreamExecutionEnvironment</code> the basis of any Flink application</li><li>create a new <code>DataStream</code> in the application environment, the <code>SimpleStringGenerator</code> class implements the <code>[SourceFunction](https://ci.apache.org/projects/flink/flink-docs-release-1.1/api/java/)</code> the base interface for all streams data sources in Flink.</li><li>add the <code>FlinkKafkaProducer09</code> sink to the streams; since MapR Streams is based on Kafka API 0.9, it is possible to use the FlinkKafkaProducer09 class; with 2 small differences:<ul><li>the broker list (first parameter) is not used since MapR Streams use the cluster location defined in the <code>/opt/mapr/conf/mapr-clusters.conf</code> class.</li><li>the topic name include the path and name of the MapR Stream stream in which the topic is located for example <code>/apps/application-stream:flink-demo</code></li></ul></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="consumer"></a>Consumer<a class="hash-link" href="#consumer" title="Direct link to heading">#</a></h3><p>The consumer simply reads the messages from the <code>/apps/application-stream:flink-demo</code> topic, and print them into the console.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  public static void main(String[] args) throws Exception {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // create execution environment</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    StreamExecutionEnvironment env = StreamExecutionEnvironment.getExecutionEnvironment();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    Properties properties = new Properties();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    // properties.setProperty(&quot;bootstrap.servers&quot;, &quot;&lt;kafka-broker&gt;:9092&quot;); // not used by MapR Streams</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    properties.setProperty(&quot;group.id&quot;, &quot;flink_consumer&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    DataStream&lt;String&gt; stream = env.addSource(new FlinkKafkaConsumer09&lt;&gt;(</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &quot;/apps/application-stream:flink-demo&quot;, new SimpleStringSchema(), properties) );</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    stream.map(new MapFunction&lt;String, String&gt;() {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      private static final long serialVersionUID = -6867736771747690202L;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      @Override</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      public String map(String value) throws Exception {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        return &quot;Stream Value: &quot; + value;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }).print();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    env.execute();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  }</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The main steps are:</p><ul><li>create a new <code>StreamExecutionEnvironment</code> the basis of any Flink application</li><li>create a set of properties with the consumer information, in this application we can only set the consumer <code>group.id</code>. Note that the <code>bootstrap.servers</code> property is not used by MapR Streams, so no need to set it.</li><li>use the <code>FlinkKafkaConsumer09</code> to get the message from the MapR Streams topic <code>/apps/application-stream:flink-demo</code></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="build-and-run-the-application"></a>Build and Run the application<a class="hash-link" href="#build-and-run-the-application" title="Direct link to heading">#</a></h2><p>Letâ€™s run the application directly from Maven (or from your favorite IDE).</p><p>1- Build the project:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ mvn clean package</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>2- Run the Flink Producer Job</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ mvn exec:java -Dexec.mainClass=com.mapr.demos.WriteToKafka</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>3- Run the Flink Consumer Job</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ mvn exec:java -Dexec.mainClass=com.mapr.demos.ReadFromKafka</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>In the terminal, you should see the messages generated from the producer</p><p>You can now deploy and execute this job on your Flink cluster.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="conclusion"></a>Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">#</a></h2><p>In this article you have learned how to use Flink with MapR Streams to write and read data streams. The key element is the configuration of the Maven Dependencies to configure the project to use MapR Streams libraries instead of Kafka ones.</p><p>This was originally published on the <a href="https://www.mapr.com/blog/getting-started-apache-flink-and-mapr-streams" target="_blank" rel="noopener noreferrer">MapR blog here</a>.</p><p>Learn about what Apache Flink can do and how it maintains consistency and provides flexibility in the &quot;<a href="https://www.mapr.com/introduction-to-apache-flink" target="_blank" rel="noopener noreferrer">Introduction to Apache Flink</a>&quot; ebook.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2017/01/02/getting-started-with-mqtt"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« Getting Started with MQTT and Java</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2016/10/12/getting-started-with-apache-flink-and-kafka"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Getting started with Apache Flink and Kafka Â»</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#introduction" class="table-of-contents__link">Introduction</a><ul><li><a href="#prerequisites" class="table-of-contents__link">Prerequisites</a></li></ul></li><li><a href="#create-your-flink-streaming-project" class="table-of-contents__link">Create your Flink Streaming Project</a></li><li><a href="#add-kafka--mapr-streams-dependencies" class="table-of-contents__link">Add Kafka &amp; MapR Streams Dependencies</a></li><li><a href="#create-the-mapr-streams-and-topic" class="table-of-contents__link">Create the MapR Streams and Topic</a><ul><li><a href="#install-and-use-mapr-kafka-utilities" class="table-of-contents__link">Install and use MapR Kafka utilities</a></li></ul></li><li><a href="#write-your-flink-application" class="table-of-contents__link">Write your Flink application</a><ul><li><a href="#producer" class="table-of-contents__link">Producer</a></li><li><a href="#consumer" class="table-of-contents__link">Consumer</a></li></ul></li><li><a href="#build-and-run-the-application" class="table-of-contents__link">Build and Run the application</a></li><li><a href="#conclusion" class="table-of-contents__link">Conclusion</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/tgrall" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.linkedin.com/in/tugdualgrall/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.instagram.com/tgrall/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Instagram<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/tgrall" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2003 - 2021 Tugdual Grall built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.e6fab63a.js"></script>
<script src="/assets/js/main.f5c6966c.js"></script>
</body>
</html>