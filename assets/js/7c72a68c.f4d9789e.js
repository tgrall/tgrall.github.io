"use strict";(self.webpackChunktgrall_blog=self.webpackChunktgrall_blog||[]).push([[43449],{3905:(e,t,o)=>{o.d(t,{Zo:()=>c,kt:()=>y});var n=o(67294);function r(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function a(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?a(Object(o),!0).forEach((function(t){r(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):a(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function l(e,t){if(null==e)return{};var o,n,r=function(e,t){if(null==e)return{};var o,n,r={},a=Object.keys(e);for(n=0;n<a.length;n++)o=a[n],t.indexOf(o)>=0||(r[o]=e[o]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(n=0;n<a.length;n++)o=a[n],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(r[o]=e[o])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),o=t;return e&&(o="function"==typeof e?e(t):i(i({},t),e)),o},c=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},h={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},u=n.forwardRef((function(e,t){var o=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),u=p(o),y=r,d=u["".concat(s,".").concat(y)]||u[y]||h[y]||a;return o?n.createElement(d,i(i({ref:t},c),{},{components:o})):n.createElement(d,i({ref:t},c))}));function y(e,t){var o=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=o.length,i=new Array(a);i[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var p=2;p<a;p++)i[p]=o[p];return n.createElement.apply(null,i)}return n.createElement.apply(null,o)}u.displayName="MDXCreateElement"},97028:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>l,toc:()=>p});var n=o(87462),r=(o(67294),o(3905));const a={title:"Revoke Deploy Keys with GitHub CLI",description:"In this post, I will show you how to use GitHub CLI to invalidate deploy keys at the organization level.",tags:["GitHub","CLI","API","CI/CD","DevOps","SSH"],keywords:["GitHub","CLI","API","CI/CD","DevOps","SSH"]},i=void 0,l={permalink:"/blog/2023/03/31/revoke-github-deploy-key-org-level",editUrl:"https://github.dev/tgrall/tgrall.github.io/blob/main/blog/2023-03-31-revoke-github-deploy-key-org-level.md",source:"@site/blog/2023-03-31-revoke-github-deploy-key-org-level.md",title:"Revoke Deploy Keys with GitHub CLI",description:"In this post, I will show you how to use GitHub CLI to invalidate deploy keys at the organization level.",date:"2023-03-31T00:00:00.000Z",formattedDate:"March 31, 2023",tags:[{label:"GitHub",permalink:"/blog/tags/git-hub"},{label:"CLI",permalink:"/blog/tags/cli"},{label:"API",permalink:"/blog/tags/api"},{label:"CI/CD",permalink:"/blog/tags/ci-cd"},{label:"DevOps",permalink:"/blog/tags/dev-ops"},{label:"SSH",permalink:"/blog/tags/ssh"}],readingTime:1.665,hasTruncateMarker:!1,authors:[],frontMatter:{title:"Revoke Deploy Keys with GitHub CLI",description:"In this post, I will show you how to use GitHub CLI to invalidate deploy keys at the organization level.",tags:["GitHub","CLI","API","CI/CD","DevOps","SSH"],keywords:["GitHub","CLI","API","CI/CD","DevOps","SSH"]},nextItem:{title:"GitHub Copilot: How I use it, and Why I love it",permalink:"/blog/2023/02/21/copilot-how-i-use-it-why-i-love-it"}},s={authorsImageUrls:[]},p=[],c={toc:p};function h(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},c,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Use GitHub CLI to Invalide Deploy Keys at the Organization Level",src:o(17561).Z,width:"960",height:"502"})),(0,r.kt)("p",null,"When working with Github, you may need to manage ",(0,r.kt)("a",{parentName:"p",href:"https://docs.github.com/en/authentication/connecting-to-github-with-ssh/managing-deploy-keys"},"deploy keys")," to allow automated deployments from external services. Deploy keys are SSH keys that grant read-only or read-write access to a single repository. You can add deploy keys to your repository from the settings page, but what if you need to revoke access for many repositories at once?"),(0,r.kt)("p",null,"Today, there's no direct way to do this from the Github UI, but you can easily accomplish it with the APIs and the ",(0,r.kt)("a",{parentName:"p",href:"https://cli.github.com/"},"GitHub CLI ",(0,r.kt)("inlineCode",{parentName:"a"},"gh")),"."),(0,r.kt)("p",null,"I have created the following script to achieve this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'#!/bin/bash\n\nORG=$1\n\nif [ -z "$ORG" ]\nthen\n  echo "No organization provided"\n  exit 1\nfi\n\nREPOS=$(gh repo list $ORG -L 200 --json name --jq \'.[].name\')\n\nfor repo in $REPOS\ndo\n  echo "Deployment keys for $repo:"\n  KEYS=$(gh api repos/$ORG/$repo/keys | jq -r \'.[] | [.id] | @tsv\')\n  if [ -z "$KEYS" ]\n  then\n    echo -e \'\\t No Deployment Key\'\n  else\n    for key in $KEYS\n    do\n    gh repo deploy-key delete -R $ORG/$repo $key\n    done\n  fi\ndone\n\n')),(0,r.kt)("p",null,"You can use it like this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"./revoke-deploy-keys.sh <org-name>\n")),(0,r.kt)("p",null,"Let's take a closer look at the script itself. It starts by setting a variable named \"",(0,r.kt)("inlineCode",{parentName:"p"},"ORG"),'" to the value passed as a parameter when the script is run. The script then uses the ',(0,r.kt)("inlineCode",{parentName:"p"},"gh"),' CLI to retrieve a list of repositories for the organization and stores them in a variable named "',(0,r.kt)("inlineCode",{parentName:"p"},"REPOS"),'".'),(0,r.kt)("p",null,"Next, the script loops through each repository and retrieves a list of deploy keys using the GH API. If there are no deploy keys, the script simply prints a message saying so. Otherwise, the script loops through each key and uses the ",(0,r.kt)("inlineCode",{parentName:"p"},"gh")," CLI to delete it using the command ",(0,r.kt)("a",{parentName:"p",href:"https://cli.github.com/manual/gh_repo_deploy-key_delete"},(0,r.kt)("inlineCode",{parentName:"a"},"gh repo deploy-key delete")),"."),(0,r.kt)("p",null,"Overall, the script is a quick and easy way to revoke deploy keys for an entire organization's repositories. By combining the ",(0,r.kt)("inlineCode",{parentName:"p"},"gh")," CLI and Github API, you can automate this process and save time and effort."))}h.isMDXComponent=!0},17561:(e,t,o)=>{o.d(t,{Z:()=>n});const n=o.p+"assets/images/header-2c4c9b14c3bb336e8f8a687873228176.png"}}]);